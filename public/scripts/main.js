function setupPlayerOption(){function e(){var e=Math.floor(3*Math.random())+1,o=Math.floor(3*Math.random())+1,t=document.querySelector("#r"+e+"c"+o);t.classList.add("x")}var o=function(){for(var o=document.querySelectorAll(".game button"),t=0;t<o.length;t++)o[t].classList.remove("reset");bot=this.classList.contains("x")?"o":"x",player="x"===bot?"o":"x";var r=document.querySelector(".game");r.classList.remove("off"),r.classList.add("on");var s=document.querySelector(".status");s.innerText="Game on","x"===bot?e():s.innerText="Your move"},t=document.querySelectorAll(".player");t[0].onclick=o,t[1].onclick=o}function processPlayerInput(){function e(){result="Game on";var e=document.querySelector(".status");return positions=l(),winner=i(positions),winner?(n(winner),winner[0]==bot?(result="Bot ("+bot+") wins.",e.classList.add("lost")):(result="You ("+player+") win!",e.classList.add("won")),window.setTimeout(o,3e3)):t()&&(result="It's a tie!",e.classList.add("tie"),window.setTimeout(o,3e3)),e.innerText=result,result}function o(){bot="b",player="b";var e=document.querySelector(".game");e.classList.remove("on"),e.classList.add("off");for(var o=document.querySelectorAll(".game button"),t=0;t<o.length;t++)o[t].classList.add("reset"),o[t].classList.remove("x"),o[t].classList.remove("o"),o[t].classList.remove("win");var r=document.querySelector(".status");r.classList.remove("won"),r.classList.remove("tie"),r.classList.remove("lost"),r.innerText="..."}function t(){return positions=l(),winner=i(positions),!winner&&!positions.toString().includes("b")}function s(){positions=l();var e=[bot+bot+"b",bot+"b"+bot,"b"+bot+bot],o=a(positions,e);if(o);else{var t=[player+player+"b",player+"b"+player,"b"+player+player];if(o=a(positions,t));else{var r=[bot+"bb","bb"+bot,"b"+bot+"b"];if(o=a(positions,r));else{var s=[player+"bb","bb"+player,"b"+player+"b"];if(o=a(positions,s));else{var n=[player+"b"+bot,bot+"b"+player,"b"+player+bot,"b"+bot+player,bot+player+"b",player+bot+"b"];o=a(positions,n)}}}}}function n(e){if(e[1]==e[3]||e[2]==e[4])for(var o=e[1];o<=e[3];o++)for(var t=e[2];t<=e[4];t++){var r=document.querySelector("#r"+o+"c"+t);r.classList.add("win")}else if(1==e[1]&&3==e[2])for(var s=1;s<4;s++){var r=document.querySelector("#r"+s+"c"+(4-s));r.classList.add("win")}else if(1==e[1]&&1==e[2])for(var s=1;s<4;s++){var r=document.querySelector("#r"+s+"c"+s);r.classList.add("win")}}function a(e,o){console.log("patterns: "+o);for(var t=!1,s=0;s<3;s++){var n=e[0][s]+e[1][s]+e[2][s];o.includes(e[s])?(c=e[s].indexOf("b")+1,r=s+1,t=[r,c]):o.includes(n)&&(r=n.indexOf("b")+1,c=s+1,t=[r,c])}var a=e[0][0]+e[1][1]+e[2][2],i=e[0][2]+e[1][1]+e[2][0];if(o.includes(a)){var l=a.indexOf("b");r=l+1,c=l+1,t=[r,c]}else if(o.includes(i)){var l=i.indexOf("b");c=3-l,r=l+1,t=[r,c]}if(console.log("after diagonal check result:"+t),t){console.log("findbestslot:trying to fill slot");var u=document.querySelector("#r"+t[0]+"c"+t[1]);u.classList.add(bot)}return t}function i(e){for(var o=!1,t=0;t<3;t++){var r=e[0][t]+e[1][t]+e[2][t];if("xxx"===e[t]?o=["x",t+1,1,t+1,3]:"ooo"===e[t]?o=["o",t+1,1,t+1,3]:"xxx"===r?o=["x",1,t+1,3,t+1]:"ooo"===r&&(o=["o",1,t+1,3,t+1]),o)break}var s=e[0][0]+e[1][1]+e[2][2],n=e[0][2]+e[1][1]+e[2][0];return o||("xxx"===s?o=["x",1,1,3,3]:"xxx"===n?o=["x",1,3,3,1]:"ooo"===s?o=["o",1,1,3,3]:"ooo"===n&&(o=["0",1,3,3,1])),o}function l(){for(var e=[],o=1;o<4;o++){for(var t="",r=1;r<4;r++){var s=document.querySelector("#r"+o+"c"+r);t+=s.classList.contains("x")?"x":s.classList.contains("o")?"o":"b"}e.push(t)}return e}for(var u=function(){var o=l(),t=i(o);t||this.classList.contains("x")||this.classList.contains("o")||this.classList.add(player);var r=e();console.log("game status after user input: "+r),"Game on"==r&&(s(),e())},b=document.querySelectorAll(".game button"),d=0;d<b.length;d++)b[d].onclick=u}var player="b",bot="b";document.addEventListener("DOMContentLoaded",function(e){setupPlayerOption(),processPlayerInput()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsic2V0dXBQbGF5ZXJPcHRpb24iLCJmaXJzdE1vdmUiLCJyIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiYyIsInJhbmQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjbGFzc0xpc3QiLCJhZGQiLCJwbGF5ZXJDaG9pY2UiLCJidXR0b25zIiwicXVlcnlTZWxlY3RvckFsbCIsImkiLCJsZW5ndGgiLCJyZW1vdmUiLCJib3QiLCJ0aGlzIiwiY29udGFpbnMiLCJwbGF5ZXIiLCJnYW1lIiwic3RhdHVzIiwiaW5uZXJUZXh0IiwicGxheWVyT3B0aW9ucyIsIm9uY2xpY2siLCJwcm9jZXNzUGxheWVySW5wdXQiLCJldmFsdWF0ZUdhbWVTdGF0dXMiLCJyZXN1bHQiLCJwb3NpdGlvbnMiLCJnZXRHYW1lUG9zaXRpb25zIiwid2lubmVyIiwiZ2V0V2lubmVyIiwiZm9ybWF0V2lubmVyIiwid2luZG93Iiwic2V0VGltZW91dCIsInJlc2V0R2FtZSIsImdhbWVUaWUiLCJ0b1N0cmluZyIsImluY2x1ZGVzIiwiYm90UmVzcG9uc2UiLCJ3aW5QYXR0ZXJucyIsIm5leHQiLCJmaWxsTmV4dEJlc3RTbG90IiwiZGVmZW5jZVBhdHRlcm5zIiwic3RyYXRlZ2ljV2luUGF0dGVybnMiLCJzdHJhdGVnaWNEZWZlbmNlUGF0dGVybnMiLCJvbmVMYXN0U2xvdFBhdHRlcm5zIiwiYmxvY2siLCJwYXR0ZXJucyIsImNvbnNvbGUiLCJsb2ciLCJjb2x1bW4iLCJpbmRleE9mIiwiZGlhZzEiLCJkaWFnMiIsImluZGV4IiwibmV4dEJsb2NrIiwiZ2FtZVBvc2l0aW9ucyIsInJvdyIsImoiLCJwb3NpdGlvbiIsInB1c2giLCJidXR0b25DbGlja0hhbmRsZXIiLCJnYW1lU3RhdHVzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiXSwibWFwcGluZ3MiOiJBQWtCQSxRQUFTQSxxQkErQlAsUUFBU0MsS0FDUCxHQUFJQyxHQUFFQyxLQUFLQyxNQUFvQixF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QVVDLElBQUlVLE9BR3JCLElBQUk0QyxHQUFXckMsR0FDZnVCLFNBQVFDLElBQUksaUNBQW1DYSxHQUNoQyxXQUFaQSxJQUNEeEIsSUFDQWIsTUFxUUFmLEVBQVFMLFNBQVNNLGlCQUFpQixnQkFDOUJDLEVBQUUsRUFBRUEsRUFBRUYsRUFBUUcsT0FBT0QsSUFDM0JGLEVBQVFFLEdBQUdXLFFBQVFzQyxFQTNWckIsR0FBSTNDLFFBQU8sSUFDUEgsSUFBSSxHQUNWVixVQUFTMEQsaUJBQWlCLG1CQUFtQixTQUFTQyxHQUlwRG5FLG9CQUNBMkIiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICAqIHdhaXQgdW50aWwgdGhlIGRvYyBpcyByZWFkeSB0byBvYmV5IG9yZGVyc1xuICAqL1xuICB2YXIgcGxheWVyPVwiYlwiO1xuICB2YXIgYm90PVwiYlwiO1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIixmdW5jdGlvbihlKXtcbiAgLyoqXG4gICAgKiBvbmNlIGNvbnRlbnQgaXMgbG9hZGVkXG4gICAgKi9cbiAgc2V0dXBQbGF5ZXJPcHRpb24oKTtcbiAgcHJvY2Vzc1BsYXllcklucHV0KCk7XG59KTtcblxuLyoqXG4gICogaGFuZGxlIHBsYXllciBjaG9pY2Ugb2YgeCBvciBvIGF0IHRoZSBzdGFydCBvZiBlYWNoIGdhbWVcbiAgKiBnZXQgdGhlIGdhbWUgYm9hcmQgcmVhZHlcbiAgKiBsZXQgdGhlIGJvdCBtYWtlIGZpcnN0IG1vdmUgaWYgcGxheWVyIGNob3NlcyB0byBiZSAnbydcbiAgKi9cbmZ1bmN0aW9uIHNldHVwUGxheWVyT3B0aW9uKCl7XG5cbiAgLy9jYWxsZWQgdG8gaGFuZGxlIHVzZXIgY2hvaWNlIGJlZm9yZSBlYWNoIGdhbWVcbiAgLy9hbHNvIHN0YXJ0cyB0aGUgZ2FtZSBpZiBib3QgaGFzIHRvIG1ha2UgZmlyc3QgbW92ZVxuICB2YXIgcGxheWVyQ2hvaWNlPWZ1bmN0aW9uKCl7XG4gICAgLy8gc3RhcnQgdGhlIGdhbWUgYnkgcmV2ZWFsaW5nIHRoZSBib2FyZFxuICAgIHZhciBidXR0b25zPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZ2FtZSBidXR0b25cIik7XG4gICAgZm9yKHZhciBpPTA7aTxidXR0b25zLmxlbmd0aDtpKyspe1xuICAgICAgYnV0dG9uc1tpXS5jbGFzc0xpc3QucmVtb3ZlKFwicmVzZXRcIik7XG4gICAgfVxuICAgIC8vcmVtZW1iZXIgcGxheWVyIGNob2ljZSBhbmQgZGV0ZXJtaW5lIG9wdGlvbiBmb3IgYm90XG4gICAgYm90PSh0aGlzLmNsYXNzTGlzdC5jb250YWlucyhcInhcIikpID8gXCJvXCIgOiBcInhcIjtcbiAgICBwbGF5ZXI9KGJvdD09PVwieFwiKSA/IFwib1wiIDogXCJ4XCI7XG4gICAgLy8gY2xvbmUgb3B0aW9uIHBhbmVsXG4gICAgdmFyIGdhbWU9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbWUnKTtcbiAgICBnYW1lLmNsYXNzTGlzdC5yZW1vdmUoJ29mZicpO1xuICAgIGdhbWUuY2xhc3NMaXN0LmFkZCgnb24nKTtcbiAgICAvLyBzZXQgdGhlIHByb3BlciBzdGF0dXMgZm9yIHVzZXIgZXhwZXJpZW5jZVxuICAgIHZhciBzdGF0dXM9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN0YXR1cycpO1xuICAgIHN0YXR1cy5pbm5lclRleHQ9XCJHYW1lIG9uXCI7XG4gICAgLy9tYWtlIGEgbW92ZSAtT1ItIGFzayB0aGUgcGxheWVyIHRvIHN0YXJ0XG4gICAgaWYoYm90PT09XCJ4XCIpXG4gICAgICBmaXJzdE1vdmUoKTtcbiAgICBlbHNlXG4gICAgICBzdGF0dXMuaW5uZXJUZXh0PVwiWW91ciBtb3ZlXCI7XG4gIH07XG5cbiAgLyoqXG4gICAgKiBtYWtlIGEgcmFuZG9tIHBpY2sgaWYgYm90IHBsYXlzIGZpcnN0XG4gICAgKiBlYWNoIGJsb2NrIGhhcyAjclhjWSBpZCBob29rIGxpa2UgI3IxYzFcbiAgICAqL1xuICBmdW5jdGlvbiBmaXJzdE1vdmUoKXtcbiAgICB2YXIgcj1NYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMykrMTtcbiAgICB2YXIgYz1NYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMykrMTtcbiAgICB2YXIgcmFuZD1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JcIisgciArIFwiY1wiICtjKTtcbiAgICByYW5kLmNsYXNzTGlzdC5hZGQoXCJ4XCIpOyAvLyBhZGQgYm90IGNsYXNzXG4gIH07XG5cbiAgLy9jYWxsIHBsYXllciBjaG9pY2UsIG9uY2UgdGhlIHVzZXIgbWFrZXMgYSBzZWxlY3Rpb25cbiAgdmFyIHBsYXllck9wdGlvbnM9ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBsYXllcicpO1xuICBwbGF5ZXJPcHRpb25zWzBdLm9uY2xpY2s9cGxheWVyQ2hvaWNlO1xuICBwbGF5ZXJPcHRpb25zWzFdLm9uY2xpY2s9cGxheWVyQ2hvaWNlO1xuXG59XG5cbi8qKlxuICAqIHByb2Nlc3MgdXNlciBzZWxlY3Rpb24gZHVyaW5nIGdhbWVcbiAgKiBkZXRlcm1pbmUgaWYgdGhlIGdhbWUgaXMgb3ZlclxuICAqIGlmIHRoZSBnYW1lIGlzIHN0aWxsIG9uLCBzZW5kIGJvdCdzIHJlc3BvbnNlXG4gICogYW5kIGV2YWx1YXRlIGlmIHRoZSBnYW1lIGlzIHN0aWxsIG9uLlxuICAqL1xuZnVuY3Rpb24gcHJvY2Vzc1BsYXllcklucHV0KCl7XG4gIC8qKlxuICAgICogaGFuZGxlIHVzZXIgY2xpY2sgb24gdGhlIGdhbWUgYmxvY2tzXG4gICAgKi9cbiAgdmFyIGJ1dHRvbkNsaWNrSGFuZGxlcj1mdW5jdGlvbigpe1xuICAgIC8vZ2V0IGN1cnJlbnQgYm9hcmQgcG9zaXRpb25zXG4gICAgdmFyIHBvc2l0aW9ucz1nZXRHYW1lUG9zaXRpb25zKCk7XG4gICAgLy9jaGVjayBmb3Igd2lubmVyIHBvc2l0aW9uc1xuICAgIHZhciB3aW5uZXI9Z2V0V2lubmVyKHBvc2l0aW9ucyk7XG4gICAgLy8gZG8gbm90aGluZyBpZiB0aGUgYmxvY2sgYWxyZWFkeSBoYXMgeCBvciBvIChhbmQgdGhlIGdhbWUgaXMgc3RpbGwgb24pXG4gICAgaWYoIXdpbm5lciAmJiAhdGhpcy5jbGFzc0xpc3QuY29udGFpbnMoXCJ4XCIpICYmICF0aGlzLmNsYXNzTGlzdC5jb250YWlucyhcIm9cIikpe1xuICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKHBsYXllcik7XG4gICAgfVxuXG4gICAgdmFyIGdhbWVTdGF0dXM9ZXZhbHVhdGVHYW1lU3RhdHVzKCk7IC8vZXZhbHVhdGUgdGhlIGJvYXJkIGZvciB1c2VyIGlucHV0XG4gICAgY29uc29sZS5sb2coXCJnYW1lIHN0YXR1cyBhZnRlciB1c2VyIGlucHV0OiBcIiArIGdhbWVTdGF0dXMpO1xuICAgIGlmKGdhbWVTdGF0dXM9PVwiR2FtZSBvblwiKXtcbiAgICAgIGJvdFJlc3BvbnNlKCk7IC8vaWYgdGhlIGdhbWUgaXMgc3RpbGwgaW4gcHJvZ3Jlc3MsIHJlc3BvbmQgYmFjayB3aXRoIHNlbGVjdGlvblxuICAgICAgZXZhbHVhdGVHYW1lU3RhdHVzKCk7IC8vZXZhbHVhdGUgdGhlIGJvYXJkIGZvciBib3QgcmVzcG9uc2VcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAgKiBldmFsdWF0ZSB0aGUgYm9hcmQgZm9yIGN1cnJlbnQgc3RhdHVzXG4gICAgKiBwb3NzaWJsZSBnYW1lIHN0YXR1c1xuICAgICogLS0gXCJHYW1lIG9uXCIgLS1kZWZhdWx0XG4gICAgKiAtLSBcIllvdSB3aW5cIlxuICAgICogLS0gXCJCb3Qgd2luc1wiXG4gICAgKiAtLSBcIkl0J3MgYSB0aWVcIlxuICAgICovXG4gIGZ1bmN0aW9uIGV2YWx1YXRlR2FtZVN0YXR1cygpe1xuICAgIHJlc3VsdD1cIkdhbWUgb25cIjtcbiAgICB2YXIgc3RhdHVzPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdGF0dXMnKTtcblxuICAgIHBvc2l0aW9ucz1nZXRHYW1lUG9zaXRpb25zKCk7IC8vZ2V0IHBvc2l0aW9ucyBhZ2FpbiwgYmFzZWQgb24gbGFzdCB1c2VyIGlucHV0XG4gICAgd2lubmVyPWdldFdpbm5lcihwb3NpdGlvbnMpO1xuXG4gICAgaWYod2lubmVyKXtcbiAgICAgIC8qKlxuICAgICAgICAqIGlmIGVpdGhlciB0aGUgcGxheWVyIG9yIHRoZSBib3QgaGFzIHdvblxuICAgICAgICAqIGZvcm1hdCB0aGUgYm9hcmQgYW5kIHNlbmQgdGhlIHN0YXR1cyBiYWNrXG4gICAgICAgICogY2FsbCBiYWNrIHJlc2V0R2FtZSB0byBnZXQgcmVhZHkgZm9yIG5leHQgZ2FtZVxuICAgICAgICAqL1xuICAgICAgZm9ybWF0V2lubmVyKHdpbm5lcik7XG4gICAgICBpZih3aW5uZXJbMF09PWJvdCl7XG4gICAgICAgIHJlc3VsdD1cIkJvdCAoXCIrIGJvdCArIFwiKSB3aW5zLlwiO1xuICAgICAgICBzdGF0dXMuY2xhc3NMaXN0LmFkZChcImxvc3RcIik7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgcmVzdWx0PVwiWW91IChcIiArIHBsYXllciArIFwiKSB3aW4hXCI7XG4gICAgICAgIHN0YXR1cy5jbGFzc0xpc3QuYWRkKFwid29uXCIpO1xuICAgICAgfVxuICAgICAgLypyZXN1bHQ9KHdpbm5lclswXT09Ym90KT8gXCJCb3QgKFwiKyBib3QgKyBcIikgd2lucy5cIiA6IFwiWW91IChcIiArIHBsYXllciArIFwiKSB3aW4hXCI7XG4gICAgICBzdGF0dXMuY2xhc3NMaXN0LmFkZChcIndvblwiKTsgLy9jYWxsIGZvciBhdHRlbnRpb24qL1xuICAgICAgd2luZG93LnNldFRpbWVvdXQocmVzZXRHYW1lLDMwMDApO1xuICAgIH1lbHNlIGlmIChnYW1lVGllKCkpe1xuICAgICAgLy9pZiBpdCdzIGEgdGllIGNhbGwgYmFjayByZXNldEdhbWUgdG8gZ2V0IHJlYWR5IGZvciBuZXh0IGdhbWVcbiAgICAgIHJlc3VsdD1cIkl0J3MgYSB0aWUhXCI7XG4gICAgICBzdGF0dXMuY2xhc3NMaXN0LmFkZChcInRpZVwiKTsgLy9jYWxsIGZvciBhdHRlbnRpb25cbiAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KHJlc2V0R2FtZSwzMDAwKTtcbiAgICB9XG4gICAgLy91cGRhdGUgc3RhdHVzIGZpZWxkXG4gICAgc3RhdHVzLmlubmVyVGV4dD1yZXN1bHQ7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8vZ2V0IHJlYWR5IGZvciB0aGUgbmV4dCBnYW1lXG4gIGZ1bmN0aW9uIHJlc2V0R2FtZSgpe1xuICAgIC8vcmVzZXQgcGxheWVyIGNob2ljZVxuICAgIGJvdD1cImJcIjtcbiAgICBwbGF5ZXI9XCJiXCI7XG4gICAgLyoqXG4gICAgICAqIHNldCB0aGUgZmxhZyB0byBnYW1lIG9mZlxuICAgICAgKiB0aGlzIHdpbGwgaGlkZSB0aGUgYm9hcmQgYW5kIHNob3cgdGhlIG9wdGlvbiBwYW5lbFxuICAgICAgKiBmb3IgdXNlciB0byBtYWtlIGEgY2hvaWNlIGFnYWluXG4gICAgICAqL1xuICAgIHZhciBnYW1lPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5nYW1lJyk7XG4gICAgZ2FtZS5jbGFzc0xpc3QucmVtb3ZlKCdvbicpO1xuICAgIGdhbWUuY2xhc3NMaXN0LmFkZCgnb2ZmJyk7XG4gICAgLyoqXG4gICAgICAqIHJlbW92ZSBlYXJsaWVyIHBsYXllciBhbmQgYm90IHNlbGVjdGlvbnMgZnJvbSBibG9ja3NcbiAgICAgICogYWRkIHJlc2V0IGNsYXNzIGZvciB1eFxuICAgICAgKiByZW1vdmUgd2luIGNsYXNzIHRvIHJlc2V0IGFueSBoaWdobGlnaHRzIG9mIHdvbiBibG9jayBvcmRlclxuICAgICAgKi9cbiAgICB2YXIgYnV0dG9ucz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmdhbWUgYnV0dG9uXCIpO1xuICAgIGZvcih2YXIgaT0wO2k8YnV0dG9ucy5sZW5ndGg7aSsrKXtcbiAgICAgIGJ1dHRvbnNbaV0uY2xhc3NMaXN0LmFkZChcInJlc2V0XCIpO1xuICAgICAgYnV0dG9uc1tpXS5jbGFzc0xpc3QucmVtb3ZlKFwieFwiKTtcbiAgICAgIGJ1dHRvbnNbaV0uY2xhc3NMaXN0LnJlbW92ZShcIm9cIik7XG4gICAgICBidXR0b25zW2ldLmNsYXNzTGlzdC5yZW1vdmUoXCJ3aW5cIik7XG4gICAgfVxuICAgIC8vcmVzZXQgc3RhdHVzIGZpZWxkXG4gICAgdmFyIHN0YXR1cz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3RhdHVzJyk7XG4gICAgc3RhdHVzLmNsYXNzTGlzdC5yZW1vdmUoXCJ3b25cIik7XG4gICAgc3RhdHVzLmNsYXNzTGlzdC5yZW1vdmUoXCJ0aWVcIik7XG4gICAgc3RhdHVzLmNsYXNzTGlzdC5yZW1vdmUoXCJsb3N0XCIpO1xuICAgIHN0YXR1cy5pbm5lclRleHQ9XCIuLi5cIjtcbiAgfVxuXG4gIC8vYm9vbGVhbiBhbnN3ZXIgXCJpcyBpdCBhIHRpZT9cIiAodHJ1ZSAvIGZhbHNlIClcbiAgZnVuY3Rpb24gZ2FtZVRpZSgpe1xuICAgIHBvc2l0aW9ucz1nZXRHYW1lUG9zaXRpb25zKCk7XG4gICAgd2lubmVyPWdldFdpbm5lcihwb3NpdGlvbnMpO1xuICAgIC8vbm8gb25lIGhhcyB3b24gYW5kIG5vIGJsYW5rcyAoYWxsIGJsb2NrcyBmaWxsZWQgaW4pXG4gICAgcmV0dXJuICghd2lubmVyICYmICFwb3NpdGlvbnMudG9TdHJpbmcoKS5pbmNsdWRlcyhcImJcIikpO1xuICB9XG5cbiAgLyoqXG4gICAgKiB0aGUgYnJhaW4gb2YgdGhlIGJvdFxuICAgICogZmlyc3QsIHRyeSB0byB3aW4sIHRoaXMgaXMgaW1wb3J0YW50XG4gICAgKiAgZG9uJ3QgZ2l2ZSBhbm90aGVyIG9wdGlvbiBmb3IgdGhlIHBsYXllclxuICAgICogc2Vjb25kLCB0cnkgdG8gZGVmZW5kLCBjdXQgb2ZmIHBsYXllciBmcm9tIHdpbm5pbmcgaW4gdGhlIG5leHQgbW92ZVxuICAgICogdGhpcmQsIGluIGFudGljaXBhdGlvbiB0byB3aW4gaW4gdGhlIG5leHQgbW92ZSwgY3JlYXRlIGEgc2VyaWVzXG4gICAgKiBmb3VydGgsIGluIGVhcmx5IHN0YWdlcyBvZiB0aGUgZ2FtZSwgc3RheSBjbG9zZSB0byB0aGUgcGxheWVyXG4gICAgKiBmaWZ0aCwgbG9va3MgbGlrZSB0aGUgZ2FtZSBpcyBhbG1vc3QgYXQgdGhlIGVuZCwgbWF5IGJlIG9uZSBibG9jayBsZWZ0XG4gICAgKiAganVzdCBmaWxsIGl0IGluLlxuICAgICovXG4gIGZ1bmN0aW9uIGJvdFJlc3BvbnNlKCl7XG4gICAgcG9zaXRpb25zPWdldEdhbWVQb3NpdGlvbnMoKTsgLy9nZXQgY3VycmVudCBnYW1lIHBvc2l0aW9uc1xuICAgIC8vdHJ5IHRvIHdpbiBmaXJzdFxuICAgIHZhciB3aW5QYXR0ZXJucz1bYm90K2JvdCtcImJcIixib3QrXCJiXCIrYm90LFwiYlwiK2JvdCtib3RdO1xuICAgIHZhciBuZXh0PWZpbGxOZXh0QmVzdFNsb3QocG9zaXRpb25zLHdpblBhdHRlcm5zKTtcbiAgICBpZihuZXh0KXtcblxuICAgIH1lbHNle1xuICAgICAgLy9zZWNvbmQgaXMgdG8gdHJ5IGFuZCBkZWZlbmRcbiAgICAgIHZhciBkZWZlbmNlUGF0dGVybnM9W3BsYXllcitwbGF5ZXIrXCJiXCIscGxheWVyK1wiYlwiK3BsYXllcixcImJcIitwbGF5ZXIrcGxheWVyXTtcbiAgICAgIG5leHQ9ZmlsbE5leHRCZXN0U2xvdChwb3NpdGlvbnMsZGVmZW5jZVBhdHRlcm5zKTtcbiAgICAgIGlmKG5leHQpe1xuICAgICAgfWVsc2V7IC8vdGhpcmQsIHRyeSB0byBwb3NpdGlvbiBib3Qgc2lkZSBieSBzaWRlLCBpbiByZWFkaW5lc3MgZm9yIG5leHQgd2luXG4gICAgICAgIHZhciBzdHJhdGVnaWNXaW5QYXR0ZXJucz1bYm90K1wiYmJcIixcImJiXCIrYm90LFwiYlwiK2JvdCtcImJcIl07XG4gICAgICAgIG5leHQ9ZmlsbE5leHRCZXN0U2xvdChwb3NpdGlvbnMsc3RyYXRlZ2ljV2luUGF0dGVybnMpO1xuICAgICAgICBpZihuZXh0KXtcbiAgICAgICAgfWVsc2V7IC8vbXVzdCBiZSBlYXJseSBzdGFnZXMsIHRyeSB0byBwb3NpdGlvbiByaWdodCBuZXh0IHRvIHRoZSBwbGF5ZXJcbiAgICAgICAgICB2YXIgc3RyYXRlZ2ljRGVmZW5jZVBhdHRlcm5zPVtwbGF5ZXIrXCJiYlwiLFwiYmJcIitwbGF5ZXIsXCJiXCIrcGxheWVyK1wiYlwiXTtcbiAgICAgICAgICBuZXh0PWZpbGxOZXh0QmVzdFNsb3QocG9zaXRpb25zLHN0cmF0ZWdpY0RlZmVuY2VQYXR0ZXJucyk7XG4gICAgICAgICAgaWYobmV4dCl7XG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB2YXIgb25lTGFzdFNsb3RQYXR0ZXJucz1bXG4gICAgICAgICAgICAgIHBsYXllcitcImJcIitib3QsXG4gICAgICAgICAgICAgIGJvdCtcImJcIitwbGF5ZXIsXG4gICAgICAgICAgICAgIFwiYlwiK3BsYXllcitib3QsXG4gICAgICAgICAgICAgIFwiYlwiK2JvdCtwbGF5ZXIsXG4gICAgICAgICAgICAgIGJvdCtwbGF5ZXIrXCJiXCIsXG4gICAgICAgICAgICAgIHBsYXllcitib3QrXCJiXCJcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBuZXh0PWZpbGxOZXh0QmVzdFNsb3QocG9zaXRpb25zLG9uZUxhc3RTbG90UGF0dGVybnMpO1xuICAgICAgICAgICAgaWYobmV4dCl7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAgKiBmb3JtYXQgd2lubmVyIG9yZGVyXG4gICAgKi9cbiAgZnVuY3Rpb24gZm9ybWF0V2lubmVyKHdpbm5lcil7XG4gICAgaWYod2lubmVyWzFdPT13aW5uZXJbM10gfHwgd2lubmVyWzJdPT13aW5uZXJbNF0peyAvL3JvdyBvciBjb2x1bW5cbiAgICAgIGZvcih2YXIgcj13aW5uZXJbMV07cjw9d2lubmVyWzNdO3IrKyl7XG4gICAgICAgIGZvcih2YXIgYz13aW5uZXJbMl07Yzw9d2lubmVyWzRdO2MrKyl7XG4gICAgICAgICAgdmFyIGJsb2NrPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjclwiICsgciArIFwiY1wiICsgYyk7XG4gICAgICAgICAgYmxvY2suY2xhc3NMaXN0LmFkZChcIndpblwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1lbHNlIGlmKHdpbm5lclsxXT09MSAmJiB3aW5uZXJbMl09PTMpeyAvL2JvdHRvbSBsZWZ0IHRvIHRvcCByaWdodFxuICAgICAgZm9yKHZhciBpPTE7aTw0O2krKyl7XG4gICAgICAgIHZhciBibG9jaz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JcIiArIGkgKyBcImNcIiArICg0LWkpKTtcbiAgICAgICAgYmxvY2suY2xhc3NMaXN0LmFkZChcIndpblwiKTtcbiAgICAgIH1cbiAgICB9ZWxzZSBpZih3aW5uZXJbMV09PTEgJiYgd2lubmVyWzJdPT0xKXsgLy90b3AgbGVmdCB0byBib3R0b20gcmlnaHRcbiAgICAgIGZvcih2YXIgaT0xO2k8NDtpKyspe1xuICAgICAgICB2YXIgYmxvY2s9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyXCIgKyBpICsgXCJjXCIgKyBpKTtcbiAgICAgICAgYmxvY2suY2xhc3NMaXN0LmFkZChcIndpblwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICAqIGxvb2sgZm9yIHByb3ZpZGVkIHBhdHRlcnMgaW4gdGhlIGN1cnJlbnQgcG9zaXRpb25zXG4gICAgKiBhbmQgcmV0dXJuIGJlc3Qgc2xvdCB0aGF0IG1hdGNoZXMgdGhlIHBhdHRlcm5cbiAgICAqIHJldHVybiBmYWxzZSBpZiBubyBzdWNoIG1hdGNoXG4gICAgKi9cbiAgZnVuY3Rpb24gZmlsbE5leHRCZXN0U2xvdChwb3NpdGlvbnMscGF0dGVybnMpe1xuICAgIC8vbG9vayBmb3IgY29tcGxldGVkIHJvd3Mgb3IgY29sdW1ucyBpbiBwb3NpdGlvbnNcbiAgICAvL3JldHVybiB0aGUgd2lubmVyIGlmIGZvdW5kXG4gICAgY29uc29sZS5sb2coXCJwYXR0ZXJuczogXCIgKyBwYXR0ZXJucyk7XG4gICAgdmFyIHJlc3VsdD1mYWxzZTtcbiAgICBmb3IodmFyIGk9MDtpPDM7aSsrKXtcbiAgICAgIHZhciBjb2x1bW49cG9zaXRpb25zWzBdW2ldK3Bvc2l0aW9uc1sxXVtpXStwb3NpdGlvbnNbMl1baV07XG5cbiAgICAgIGlmKHBhdHRlcm5zLmluY2x1ZGVzKHBvc2l0aW9uc1tpXSkpe1xuICAgICAgICBjPXBvc2l0aW9uc1tpXS5pbmRleE9mKFwiYlwiKSsxO1xuICAgICAgICByPWkrMTtcbiAgICAgICAgcmVzdWx0PSBbcixjXTtcbiAgICAgIH0gZWxzZSBpZihwYXR0ZXJucy5pbmNsdWRlcyhjb2x1bW4pKXtcbiAgICAgICAgcj1jb2x1bW4uaW5kZXhPZihcImJcIikrMTtcbiAgICAgICAgYz1pKzE7XG4gICAgICAgIHJlc3VsdD0gW3IsY107XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy9jaGVjayBmb3IgY29tcGxldGVkIHBvc2l0aW9ucyBkaWFnb25hbGx5XG4gICAgdmFyIGRpYWcxPXBvc2l0aW9uc1swXVswXStwb3NpdGlvbnNbMV1bMV0rcG9zaXRpb25zWzJdWzJdO1xuICAgIHZhciBkaWFnMj1wb3NpdGlvbnNbMF1bMl0rcG9zaXRpb25zWzFdWzFdK3Bvc2l0aW9uc1syXVswXTtcbiAgICBpZihwYXR0ZXJucy5pbmNsdWRlcyhkaWFnMSkpe1xuICAgICAgdmFyIGluZGV4PWRpYWcxLmluZGV4T2YoXCJiXCIpO1xuICAgICAgcj1pbmRleCsxO1xuICAgICAgYz1pbmRleCsxO1xuICAgICAgcmVzdWx0PSBbcixjXTtcbiAgICB9IGVsc2UgaWYocGF0dGVybnMuaW5jbHVkZXMoZGlhZzIpKXtcbiAgICAgIHZhciBpbmRleD1kaWFnMi5pbmRleE9mKFwiYlwiKTtcbiAgICAgIGM9My1pbmRleDtcbiAgICAgIHI9aW5kZXgrMTtcbiAgICAgIHJlc3VsdD0gW3IsY107XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKFwiYWZ0ZXIgZGlhZ29uYWwgY2hlY2sgcmVzdWx0OlwiICsgcmVzdWx0KTtcbiAgICBpZihyZXN1bHQpe1xuICAgICAgY29uc29sZS5sb2coXCJmaW5kYmVzdHNsb3Q6dHJ5aW5nIHRvIGZpbGwgc2xvdFwiKTtcbiAgICAgIHZhciBuZXh0QmxvY2s9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyXCIrcmVzdWx0WzBdK1wiY1wiK3Jlc3VsdFsxXSk7XG4gICAgICBuZXh0QmxvY2suY2xhc3NMaXN0LmFkZChib3QpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIGZ1bmN0aW9uIGdldFdpbm5lcihwb3NpdGlvbnMpe1xuICAgIC8vbG9vayBmb3IgY29tcGxldGVkIHJvd3Mgb3IgY29sdW1ucyBpbiBwb3NpdGlvbnNcbiAgICAvL3JldHVybiB0aGUgd2lubmVyIGlmIGZvdW5kXG4gICAgdmFyIHJlc3VsdD1mYWxzZTtcbiAgICBmb3IodmFyIGk9MDtpPDM7aSsrKXtcbiAgICAgIHZhciBjb2x1bW49cG9zaXRpb25zWzBdW2ldK3Bvc2l0aW9uc1sxXVtpXStwb3NpdGlvbnNbMl1baV07XG4gICAgICBpZihwb3NpdGlvbnNbaV09PT1cInh4eFwiKXtcbiAgICAgICAgcmVzdWx0PVtcInhcIixpKzEsMSxpKzEsM107XG4gICAgICB9IGVsc2UgaWYocG9zaXRpb25zW2ldPT09XCJvb29cIil7XG4gICAgICAgIHJlc3VsdD1bXCJvXCIsaSsxLDEsaSsxLDNdO1xuICAgICAgfSBlbHNlIGlmKGNvbHVtbj09PVwieHh4XCIpIHtcbiAgICAgICAgcmVzdWx0PVtcInhcIiwxLGkrMSwzLGkrMV07XG4gICAgICB9IGVsc2UgaWYoY29sdW1uPT09XCJvb29cIil7XG4gICAgICAgIHJlc3VsdD1bXCJvXCIsMSxpKzEsMyxpKzFdO1xuICAgICAgfVxuICAgICAgaWYocmVzdWx0KVxuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICAvL2NoZWNrIGZvciBjb21wbGV0ZWQgcG9zaXRpb25zIGRpYWdvbmFsbHlcbiAgICB2YXIgZGlhZzE9cG9zaXRpb25zWzBdWzBdK3Bvc2l0aW9uc1sxXVsxXStwb3NpdGlvbnNbMl1bMl07XG4gICAgdmFyIGRpYWcyPXBvc2l0aW9uc1swXVsyXStwb3NpdGlvbnNbMV1bMV0rcG9zaXRpb25zWzJdWzBdO1xuICAgIGlmKCFyZXN1bHQpe1xuICAgICAgaWYoZGlhZzE9PT1cInh4eFwiKXtcbiAgICAgICAgcmVzdWx0PVtcInhcIiwxLDEsMywzXTtcbiAgICAgIH1lbHNlIGlmIChkaWFnMj09PVwieHh4XCIpe1xuICAgICAgICByZXN1bHQ9W1wieFwiLDEsMywzLDFdO1xuICAgICAgfWVsc2UgaWYoZGlhZzE9PT1cIm9vb1wiKXtcbiAgICAgICAgcmVzdWx0PVtcIm9cIiwxLDEsMywzXTtcbiAgICAgIH1lbHNlIGlmKGRpYWcyPT09XCJvb29cIil7XG4gICAgICAgIHJlc3VsdD1bXCIwXCIsMSwzLDMsMV07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgZnVuY3Rpb24gZ2V0R2FtZVBvc2l0aW9ucygpe1xuICAgIHZhciBnYW1lUG9zaXRpb25zPVtdO1xuICAgIGZvcih2YXIgaT0xO2k8NDtpKyspe1xuICAgICAgdmFyIHJvdz1cIlwiO1xuICAgICAgZm9yKHZhciBqPTE7ajw0O2orKyl7XG4gICAgICAgIHZhciBwb3NpdGlvbj1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JcIiArIGkgKyBcImNcIiArIGopO1xuICAgICAgICBpZihwb3NpdGlvbi5jbGFzc0xpc3QuY29udGFpbnMoXCJ4XCIpKVxuICAgICAgICAgIHJvdys9XCJ4XCI7XG4gICAgICAgIGVsc2UgaWYocG9zaXRpb24uY2xhc3NMaXN0LmNvbnRhaW5zKFwib1wiKSlcbiAgICAgICAgICByb3crPVwib1wiO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgcm93Kz1cImJcIjtcbiAgICAgIH1cbiAgICAgIGdhbWVQb3NpdGlvbnMucHVzaChyb3cpO1xuICAgIH1cbiAgICByZXR1cm4gZ2FtZVBvc2l0aW9ucztcbiAgfTtcblxuICB2YXIgYnV0dG9ucz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmdhbWUgYnV0dG9uXCIpO1xuICBmb3IodmFyIGk9MDtpPGJ1dHRvbnMubGVuZ3RoO2krKyl7XG4gICAgYnV0dG9uc1tpXS5vbmNsaWNrPWJ1dHRvbkNsaWNrSGFuZGxlcjtcbiAgfVxuXG59XG4iXX0=
