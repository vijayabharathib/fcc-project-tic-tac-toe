function setupPlayerOption(){function o(){var o=Math.floor(3*Math.random())+1,e=Math.floor(3*Math.random())+1,r=document.querySelector("#r"+o+"c"+e);r.classList.add("x")}var e=function(){console.log("inside player choice"),bot=this.classList.contains("x")?"o":"x",player="x"===bot?"o":"x",console.log("bot:"+bot+";player:"+player),"x"===bot&&o()},r=document.querySelectorAll(".player");r[0].onclick=e,r[1].onclick=e}function setupPlayerInput(){function o(o){if(o[1]==o[3]||o[2]==o[4])for(var e=o[1];e<=o[3];e++)for(var r=o[2];r<=o[4];r++){var t=document.querySelector("#r"+e+"c"+r);t.classList.add("win")}else if(1==o[1]&&3==o[2])for(var l=1;l<4;l++){var t=document.querySelector("#r"+l+"c"+(4-l));t.classList.add("win")}else if(1==o[1]&&1==o[2])for(var l=1;l<4;l++){var t=document.querySelector("#r"+l+"c"+l);t.classList.add("win")}}function e(o,e){console.log("patterns: "+e);for(var t=!1,l=0;l<3;l++){var a=o[0][l]+o[1][l]+o[2][l];e.includes(o[l])?(c=o[l].indexOf("b")+1,r=l+1,t=[r,c]):e.includes(a)&&(r=a.indexOf("b")+1,c=l+1,t=[r,c])}if(t)return console.log("row/col result:"+t),t;var n=o[0][0]+o[1][1]+o[2][2],s=o[0][2]+o[1][1]+o[2][0];if(console.log("diag1:"+n+";diag2:"+s),e.includes(n)){var i=n.indexOf("b");r=i+1,c=i+1,t=[r,c]}else if(e.includes(s)){var i=s.indexOf("b");c=3-i,r=i+1,t=[r,c]}return console.log("after diagonal check result:"+t),t}function t(o){for(var e=!1,r=0;r<3;r++){var t=o[0][r]+o[1][r]+o[2][r];if("xxx"===o[r]?e=["x",r+1,1,r+1,3]:"ooo"===o[r]?e=["o",r+1,1,r+1,3]:"xxx"===t?e=["x",1,r+1,3,r+1]:"ooo"===t&&(e=["o",1,r+1,3,r+1]),e)break}var l=o[0][0]+o[1][1]+o[2][2],a=o[0][2]+o[1][1]+o[2][0];return e||("xxx"===l?e=["x",1,1,3,3]:"xxx"===a?e=["x",1,3,3,1]:"ooo"===l?e=["o",1,1,3,3]:"ooo"===a&&(e=["0",1,3,3,1])),e}function l(){for(var o=[],e=1;e<4;e++){for(var r="",t=1;t<4;t++){var l=document.querySelector("#r"+e+"c"+t);r+=l.classList.contains("x")?"x":l.classList.contains("o")?"o":"b"}o.push(r)}return console.log(o),o}for(var a=document.querySelectorAll(".game button"),n=function(){var r=l(),a=t(r);if(a||this.classList.contains("x")||this.classList.contains("o")||this.classList.add(player),r=l(),a=t(r),console.log(a),a)return void o(a);var c=[bot+bot+"b",bot+"b"+bot,"b"+bot+bot],n=e(r,c);if(console.log("fill "+n+" to win."),n){var s=document.querySelector("#r"+n[0]+"c"+n[1]);if(s.classList.add(bot),r=l(),a=t(r),console.log("winner:"+a),a)return void o(a)}else{var i=[player+player+"b",player+"b"+player,"b"+player+player];if(n=e(r,i),console.log("fill "+n+" to defend"),n){var s=document.querySelector("#r"+n[0]+"c"+n[1]);s.classList.add(bot)}else{var u=[bot+"bb","bb"+bot,"b"+bot+"b"];if(n=e(r,u),console.log("fill "+n+" to position strategically"),n){var s=document.querySelector("#r"+n[0]+"c"+n[1]);s.classList.add(bot)}else{var d=[player+"bb","bb"+player,"b"+player+"b"];if(n=e(r,d),console.log("fill "+n+" to position strategically"),n){var s=document.querySelector("#r"+n[0]+"c"+n[1]);s.classList.add(bot)}}}}},s=0;s<a.length;s++)a[s].onclick=n}var player="b",bot="b";document.addEventListener("DOMContentLoaded",function(o){setupPlayerOption(),setupPlayerInput()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsic2V0dXBQbGF5ZXJPcHRpb24iLCJmaXJzdE1vdmUiLCJyIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiYyIsInJhbmQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjbGFzc0xpc3QiLCJhZGQiLCJwbGF5ZXJDaG9pY2UiLCJjb25zb2xlIiwibG9nIiwiYm90IiwidGhpcyIsImNvbnRhaW5zIiwicGxheWVyIiwicGxheWVyT3B0aW9ucyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJvbmNsaWNrIiwic2V0dXBQbGF5ZXJJbnB1dCIsImZvcm1hdFdpbm5lciIsIndpbm5lciIsImJsb2NrIiwiaSIsImZpbGwiLCJwb3NpdGlvbnMiLCJwYXR0ZXJucyIsInJlc3VsdCIsImNvbHVtbiIsImluY2x1ZGVzIiwiaW5kZXhPZiIsImRpYWcxIiwiZGlhZzIiLCJpbmRleCIsImdldFdpbm5lciIsImdldEdhbWVQb3NpdGlvbnMiLCJnYW1lUG9zaXRpb25zIiwicm93IiwiaiIsInBvc2l0aW9uIiwicHVzaCIsImJ1dHRvbnMiLCJidXR0b25DbGlja0hhbmRsZXIiLCJ3aW5QYXR0ZXJucyIsIm5leHQiLCJuZXh0QmxvY2siLCJkZWZlbmNlUGF0dGVybnMiLCJzdHJhdGVnaWNXaW5QYXR0ZXJucyIsInN0cmF0ZWdpY0RlZmVuY2VQYXR0ZXJucyIsImxlbmd0aCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIl0sIm1hcHBpbmdzIjoiQUFnQkEsUUFBU0EscUJBVVAsUUFBU0MsS0FDUCxHQUFJQyxHQUFFQyxLQUFLQyxNQUFvQixFQUFkRCxLQUFLRSxVQUFZLEVBQzlCQyxFQUFFSCxLQUFLQyxNQUFvQixFQUFkRCxLQUFLRSxVQUFZLEVBQzlCRSxFQUFLQyxTQUFTQyxjQUFjLEtBQU1QLEVBQUksSUFBS0ksRUFDL0NDLEdBQUtHLFVBQVVDLElBQUksS0FickIsR0FBSUMsR0FBYSxXQUNmQyxRQUFRQyxJQUFJLHdCQUNaQyxJQUFLQyxLQUFLTixV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T0FBTyxJQUFJQSxPQUFPLElBR2pFLElBRkE2QixFQUFLcEIsRUFBS0MsRUFBVXVCLEdBQ3BCdEMsUUFBUUMsSUFBSSxRQUFVaUMsRUFBTyw4QkFDMUJBLEVBQUssQ0FDTixHQUFJQyxHQUFVeEMsU0FBU0MsY0FBYyxLQUFLc0MsRUFBSyxHQUFHLElBQUlBLEVBQUssR0FDM0RDLEdBQVV0QyxVQUFVQyxJQUFJSSxVQXFJMUJXLEVBQUUsRUFBRUEsRUFBRWtCLEVBQVFRLE9BQU8xQixJQUMzQmtCLEVBQVFsQixHQUFHTCxRQUFRd0IsRUE5TnJCLEdBQUkzQixRQUFPLElBQ1BILElBQUksR0FDVlAsVUFBUzZDLGlCQUFpQixtQkFBbUIsU0FBU0MsR0FPcER0RCxvQkFDQXNCIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAgKiB3YWl0IHVudGlsIHRoZSBkb2MgaXMgcmVhZHkgdG8gb2JleSBvcmRlcnNcbiAgKi9cbiAgdmFyIHBsYXllcj1cImJcIjtcbiAgdmFyIGJvdD1cImJcIjtcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsZnVuY3Rpb24oZSl7XG4gIC8qKlxuICAgICogb25jZSBjb250ZW50IGlzIGxvYWRlZFxuICAgICogYmluZCBzbGlkZXIgZnVuY3Rpb25hbGl0eSAtIHRvIHVwZGF0ZSB0ZXh0IGJveFxuICAgICogYmluZCB0ZXh0IGJveCBmdW5jdGlvbmFsaXR5IC0gdG8gdXBkYXRlIHNsaWRlclxuICAgICogYmluZCBidXR0b24gY2xpY2sgdG8gc3RhcnQvc3RvcCBjbG9ja1xuICAgICovXG4gIHNldHVwUGxheWVyT3B0aW9uKCk7XG4gIHNldHVwUGxheWVySW5wdXQoKTtcbn0pO1xuXG5mdW5jdGlvbiBzZXR1cFBsYXllck9wdGlvbigpe1xuICB2YXIgcGxheWVyQ2hvaWNlPWZ1bmN0aW9uKCl7XG4gICAgY29uc29sZS5sb2coXCJpbnNpZGUgcGxheWVyIGNob2ljZVwiKTtcbiAgICBib3Q9KHRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKFwieFwiKSkgPyBcIm9cIiA6IFwieFwiO1xuICAgIHBsYXllcj0oYm90PT09XCJ4XCIpID8gXCJvXCIgOiBcInhcIjtcbiAgICBjb25zb2xlLmxvZyhcImJvdDpcIiArIGJvdCArIFwiO3BsYXllcjpcIiArIHBsYXllcik7XG4gICAgaWYoYm90PT09XCJ4XCIpXG4gICAgICBmaXJzdE1vdmUoKTtcbiAgfTtcblxuICBmdW5jdGlvbiBmaXJzdE1vdmUoKXtcbiAgICB2YXIgcj1NYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMykrMTtcbiAgICB2YXIgYz1NYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMykrMTtcbiAgICB2YXIgcmFuZD1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JcIisgciArIFwiY1wiICtjKTtcbiAgICByYW5kLmNsYXNzTGlzdC5hZGQoXCJ4XCIpO1xuICB9O1xuXG4gIHZhciBwbGF5ZXJPcHRpb25zPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wbGF5ZXInKTtcbiAgcGxheWVyT3B0aW9uc1swXS5vbmNsaWNrPXBsYXllckNob2ljZTtcbiAgcGxheWVyT3B0aW9uc1sxXS5vbmNsaWNrPXBsYXllckNob2ljZTtcblxufVxuXG5mdW5jdGlvbiBzZXR1cFBsYXllcklucHV0KCl7XG4gIHZhciBidXR0b25zPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZ2FtZSBidXR0b25cIik7XG4gIHZhciBidXR0b25DbGlja0hhbmRsZXI9ZnVuY3Rpb24oKXtcbiAgICB2YXIgcG9zaXRpb25zPWdldEdhbWVQb3NpdGlvbnMoKTtcbiAgICB2YXIgd2lubmVyPWdldFdpbm5lcihwb3NpdGlvbnMpO1xuICAgIC8vIGRvIG5vdGhpbmcgaWYgdGhlIGJsb2NrIGFscmVhZHkgaGFzIHggb3IgbyAoYW5kIHRoZSBnYW1lIGlzIHN0aWxsIG9uKVxuICAgIGlmKCF3aW5uZXIgJiYgIXRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKFwieFwiKSAmJiAhdGhpcy5jbGFzc0xpc3QuY29udGFpbnMoXCJvXCIpKVxuICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKHBsYXllcik7XG4gICAgcG9zaXRpb25zPWdldEdhbWVQb3NpdGlvbnMoKTsgLy9nZXQgcG9zaXRpb25zIGFnYWluLCBiYXNlZCBvbiBsYXN0IHVzZXIgaW5wdXRcbiAgICB3aW5uZXI9Z2V0V2lubmVyKHBvc2l0aW9ucyk7XG4gICAgY29uc29sZS5sb2cod2lubmVyKTtcbiAgICBpZih3aW5uZXIpe1xuICAgICAgZm9ybWF0V2lubmVyKHdpbm5lcik7XG4gICAgICByZXR1cm47IC8vZ2FtZW92ZXJcbiAgICB9XG5cbiAgICB2YXIgd2luUGF0dGVybnM9W2JvdCtib3QrXCJiXCIsYm90K1wiYlwiK2JvdCxcImJcIitib3QrYm90XTtcblxuICAgIC8vdHJ5IHRvIHdpbiBmaXJzdFxuICAgIHZhciBuZXh0PWZpbGwocG9zaXRpb25zLHdpblBhdHRlcm5zKTtcbiAgICBjb25zb2xlLmxvZyhcImZpbGwgXCIgKyBuZXh0ICsgXCIgdG8gd2luLlwiKTtcbiAgICBpZihuZXh0KXtcbiAgICAgIHZhciBuZXh0QmxvY2s9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyXCIrbmV4dFswXStcImNcIituZXh0WzFdKTtcbiAgICAgIG5leHRCbG9jay5jbGFzc0xpc3QuYWRkKGJvdCk7XG4gICAgICBwb3NpdGlvbnM9Z2V0R2FtZVBvc2l0aW9ucygpO1xuICAgICAgd2lubmVyPWdldFdpbm5lcihwb3NpdGlvbnMpO1xuICAgICAgY29uc29sZS5sb2coXCJ3aW5uZXI6XCIrd2lubmVyKTtcbiAgICAgIGlmKHdpbm5lcil7XG4gICAgICAgIGZvcm1hdFdpbm5lcih3aW5uZXIpO1xuICAgICAgICByZXR1cm47IC8vZ2FtZW92ZXJcbiAgICAgIH1cbiAgICB9ZWxzZXtcbiAgICAgIC8vc2Vjb25kIGlzIHRvIHRyeSBhbmQgZGVmZW5kXG4gICAgICB2YXIgZGVmZW5jZVBhdHRlcm5zPVtwbGF5ZXIrcGxheWVyK1wiYlwiLHBsYXllcitcImJcIitwbGF5ZXIsXCJiXCIrcGxheWVyK3BsYXllcl07XG4gICAgICBuZXh0PWZpbGwocG9zaXRpb25zLGRlZmVuY2VQYXR0ZXJucyk7XG4gICAgICBjb25zb2xlLmxvZyhcImZpbGwgXCIgKyBuZXh0ICsgXCIgdG8gZGVmZW5kXCIpO1xuICAgICAgaWYobmV4dCl7XG4gICAgICAgIHZhciBuZXh0QmxvY2s9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyXCIrbmV4dFswXStcImNcIituZXh0WzFdKTtcbiAgICAgICAgbmV4dEJsb2NrLmNsYXNzTGlzdC5hZGQoYm90KTtcbiAgICAgIH1lbHNleyAvL3RoaXJkLCB0cnkgdG8gcG9zaXRpb24gYm90IHNpZGUgYnkgc2lkZSwgaW4gcmVhZGluZXNzIGZvciBuZXh0IHdpblxuICAgICAgICB2YXIgc3RyYXRlZ2ljV2luUGF0dGVybnM9W2JvdCtcImJiXCIsXCJiYlwiK2JvdCxcImJcIitib3QrXCJiXCJdO1xuICAgICAgICBuZXh0PWZpbGwocG9zaXRpb25zLHN0cmF0ZWdpY1dpblBhdHRlcm5zKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJmaWxsIFwiICsgbmV4dCArIFwiIHRvIHBvc2l0aW9uIHN0cmF0ZWdpY2FsbHlcIik7XG4gICAgICAgIGlmKG5leHQpe1xuICAgICAgICAgIHZhciBuZXh0QmxvY2s9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyXCIrbmV4dFswXStcImNcIituZXh0WzFdKTtcbiAgICAgICAgICBuZXh0QmxvY2suY2xhc3NMaXN0LmFkZChib3QpO1xuICAgICAgICB9ZWxzZXsgLy9tdXN0IGJlIGVhcmx5IHN0YWdlcywgdHJ5IHRvIHBvc2l0aW9ubiByaWdodCBuZXh0IHRvIHRoZSBwbGF5ZXJcbiAgICAgICAgICB2YXIgc3RyYXRlZ2ljRGVmZW5jZVBhdHRlcm5zPVtwbGF5ZXIrXCJiYlwiLFwiYmJcIitwbGF5ZXIsXCJiXCIrcGxheWVyK1wiYlwiXTtcbiAgICAgICAgICBuZXh0PWZpbGwocG9zaXRpb25zLHN0cmF0ZWdpY0RlZmVuY2VQYXR0ZXJucyk7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJmaWxsIFwiICsgbmV4dCArIFwiIHRvIHBvc2l0aW9uIHN0cmF0ZWdpY2FsbHlcIik7XG4gICAgICAgICAgaWYobmV4dCl7XG4gICAgICAgICAgICB2YXIgbmV4dEJsb2NrPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjclwiK25leHRbMF0rXCJjXCIrbmV4dFsxXSk7XG4gICAgICAgICAgICBuZXh0QmxvY2suY2xhc3NMaXN0LmFkZChib3QpO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgLy8jVE9ETzoganVzdCBmaWxsIHRoZSByZW1haW5pbmcgYmxvY2sgLCBpdCBsb29rcyBsaWtlIGEgdGllXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gIH07XG5cbiAgLyoqXG4gICAgKiBmb3JtYXQgd2lubmVyIG9yZGVyXG4gICAgKi9cbiAgZnVuY3Rpb24gZm9ybWF0V2lubmVyKHdpbm5lcil7XG4gICAgaWYod2lubmVyWzFdPT13aW5uZXJbM10gfHwgd2lubmVyWzJdPT13aW5uZXJbNF0peyAvL3JvdyBvciBjb2x1bW5cbiAgICAgIGZvcih2YXIgcj13aW5uZXJbMV07cjw9d2lubmVyWzNdO3IrKyl7XG4gICAgICAgIGZvcih2YXIgYz13aW5uZXJbMl07Yzw9d2lubmVyWzRdO2MrKyl7XG4gICAgICAgICAgdmFyIGJsb2NrPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjclwiICsgciArIFwiY1wiICsgYyk7XG4gICAgICAgICAgYmxvY2suY2xhc3NMaXN0LmFkZChcIndpblwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1lbHNlIGlmKHdpbm5lclsxXT09MSAmJiB3aW5uZXJbMl09PTMpeyAvL2JvdHRvbSBsZWZ0IHRvIHRvcCByaWdodFxuICAgICAgZm9yKHZhciBpPTE7aTw0O2krKyl7XG4gICAgICAgIHZhciBibG9jaz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JcIiArIGkgKyBcImNcIiArICg0LWkpKTtcbiAgICAgICAgYmxvY2suY2xhc3NMaXN0LmFkZChcIndpblwiKTtcbiAgICAgIH1cbiAgICB9ZWxzZSBpZih3aW5uZXJbMV09PTEgJiYgd2lubmVyWzJdPT0xKXsgLy90b3AgbGVmdCB0byBib3R0b20gcmlnaHRcbiAgICAgIGZvcih2YXIgaT0xO2k8NDtpKyspe1xuICAgICAgICB2YXIgYmxvY2s9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyXCIgKyBpICsgXCJjXCIgKyBpKTtcbiAgICAgICAgYmxvY2suY2xhc3NMaXN0LmFkZChcIndpblwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICAqIFRyeSB0byB3aW4gZmlyc3QgKGxvb2sgZm9yIHR3byBjb25zZWN1dGl2ZSBib3Qgb3B0aW9ucyBhbmQgZmlsbCBpbiB0aGUgdGhpcmQpXG4gICAgKi9cbiAgZnVuY3Rpb24gZmlsbChwb3NpdGlvbnMscGF0dGVybnMpe1xuICAgIC8vbG9vayBmb3IgY29tcGxldGVkIHJvd3Mgb3IgY29sdW1ucyBpbiBwb3NpdGlvbnNcbiAgICAvL3JldHVybiB0aGUgd2lubmVyIGlmIGZvdW5kXG4gICAgY29uc29sZS5sb2coXCJwYXR0ZXJuczogXCIgKyBwYXR0ZXJucyk7XG4gICAgdmFyIHJlc3VsdD1mYWxzZTtcbiAgICBmb3IodmFyIGk9MDtpPDM7aSsrKXtcbiAgICAgIHZhciBjb2x1bW49cG9zaXRpb25zWzBdW2ldK3Bvc2l0aW9uc1sxXVtpXStwb3NpdGlvbnNbMl1baV07XG5cbiAgICAgIGlmKHBhdHRlcm5zLmluY2x1ZGVzKHBvc2l0aW9uc1tpXSkpe1xuICAgICAgICBjPXBvc2l0aW9uc1tpXS5pbmRleE9mKFwiYlwiKSsxO1xuICAgICAgICByPWkrMTtcbiAgICAgICAgcmVzdWx0PSBbcixjXTtcbiAgICAgIH0gZWxzZSBpZihwYXR0ZXJucy5pbmNsdWRlcyhjb2x1bW4pKXtcbiAgICAgICAgcj1jb2x1bW4uaW5kZXhPZihcImJcIikrMTtcbiAgICAgICAgYz1pKzE7XG4gICAgICAgIHJlc3VsdD0gW3IsY107XG4gICAgICB9XG4gICAgfVxuICAgIGlmKHJlc3VsdCl7XG4gICAgICBjb25zb2xlLmxvZyhcInJvdy9jb2wgcmVzdWx0OlwiICsgcmVzdWx0KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIC8vY2hlY2sgZm9yIGNvbXBsZXRlZCBwb3NpdGlvbnMgZGlhZ29uYWxseVxuICAgIHZhciBkaWFnMT1wb3NpdGlvbnNbMF1bMF0rcG9zaXRpb25zWzFdWzFdK3Bvc2l0aW9uc1syXVsyXTtcbiAgICB2YXIgZGlhZzI9cG9zaXRpb25zWzBdWzJdK3Bvc2l0aW9uc1sxXVsxXStwb3NpdGlvbnNbMl1bMF07XG4gICAgY29uc29sZS5sb2coXCJkaWFnMTpcIitkaWFnMStcIjtkaWFnMjpcIitkaWFnMik7XG4gICAgaWYocGF0dGVybnMuaW5jbHVkZXMoZGlhZzEpKXtcbiAgICAgIHZhciBpbmRleD1kaWFnMS5pbmRleE9mKFwiYlwiKTtcbiAgICAgIHI9aW5kZXgrMTtcbiAgICAgIGM9aW5kZXgrMTtcbiAgICAgIHJlc3VsdD0gW3IsY107XG4gICAgfSBlbHNlIGlmKHBhdHRlcm5zLmluY2x1ZGVzKGRpYWcyKSl7XG4gICAgICB2YXIgaW5kZXg9ZGlhZzIuaW5kZXhPZihcImJcIik7XG4gICAgICBjPTMtaW5kZXg7XG4gICAgICByPWluZGV4KzE7XG4gICAgICByZXN1bHQ9IFtyLGNdO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhcImFmdGVyIGRpYWdvbmFsIGNoZWNrIHJlc3VsdDpcIiArIHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBmdW5jdGlvbiBnZXRXaW5uZXIocG9zaXRpb25zKXtcbiAgICAvL2xvb2sgZm9yIGNvbXBsZXRlZCByb3dzIG9yIGNvbHVtbnMgaW4gcG9zaXRpb25zXG4gICAgLy9yZXR1cm4gdGhlIHdpbm5lciBpZiBmb3VuZFxuICAgIHZhciByZXN1bHQ9ZmFsc2U7XG4gICAgZm9yKHZhciBpPTA7aTwzO2krKyl7XG4gICAgICB2YXIgY29sdW1uPXBvc2l0aW9uc1swXVtpXStwb3NpdGlvbnNbMV1baV0rcG9zaXRpb25zWzJdW2ldO1xuICAgICAgaWYocG9zaXRpb25zW2ldPT09XCJ4eHhcIil7XG4gICAgICAgIHJlc3VsdD1bXCJ4XCIsaSsxLDEsaSsxLDNdO1xuICAgICAgfSBlbHNlIGlmKHBvc2l0aW9uc1tpXT09PVwib29vXCIpe1xuICAgICAgICByZXN1bHQ9W1wib1wiLGkrMSwxLGkrMSwzXTtcbiAgICAgIH0gZWxzZSBpZihjb2x1bW49PT1cInh4eFwiKSB7XG4gICAgICAgIHJlc3VsdD1bXCJ4XCIsMSxpKzEsMyxpKzFdO1xuICAgICAgfSBlbHNlIGlmKGNvbHVtbj09PVwib29vXCIpe1xuICAgICAgICByZXN1bHQ9W1wib1wiLDEsaSsxLDMsaSsxXTtcbiAgICAgIH1cbiAgICAgIGlmKHJlc3VsdClcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgLy9jaGVjayBmb3IgY29tcGxldGVkIHBvc2l0aW9ucyBkaWFnb25hbGx5XG4gICAgdmFyIGRpYWcxPXBvc2l0aW9uc1swXVswXStwb3NpdGlvbnNbMV1bMV0rcG9zaXRpb25zWzJdWzJdO1xuICAgIHZhciBkaWFnMj1wb3NpdGlvbnNbMF1bMl0rcG9zaXRpb25zWzFdWzFdK3Bvc2l0aW9uc1syXVswXTtcbiAgICBpZighcmVzdWx0KXtcbiAgICAgIGlmKGRpYWcxPT09XCJ4eHhcIil7XG4gICAgICAgIHJlc3VsdD1bXCJ4XCIsMSwxLDMsM107XG4gICAgICB9ZWxzZSBpZiAoZGlhZzI9PT1cInh4eFwiKXtcbiAgICAgICAgcmVzdWx0PVtcInhcIiwxLDMsMywxXTtcbiAgICAgIH1lbHNlIGlmKGRpYWcxPT09XCJvb29cIil7XG4gICAgICAgIHJlc3VsdD1bXCJvXCIsMSwxLDMsM107XG4gICAgICB9ZWxzZSBpZihkaWFnMj09PVwib29vXCIpe1xuICAgICAgICByZXN1bHQ9W1wiMFwiLDEsMywzLDFdO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIGZ1bmN0aW9uIGdldEdhbWVQb3NpdGlvbnMoKXtcbiAgICB2YXIgZ2FtZVBvc2l0aW9ucz1bXTtcbiAgICBmb3IodmFyIGk9MTtpPDQ7aSsrKXtcbiAgICAgIHZhciByb3c9XCJcIjtcbiAgICAgIGZvcih2YXIgaj0xO2o8NDtqKyspe1xuICAgICAgICB2YXIgcG9zaXRpb249ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyXCIgKyBpICsgXCJjXCIgKyBqKTtcbiAgICAgICAgaWYocG9zaXRpb24uY2xhc3NMaXN0LmNvbnRhaW5zKFwieFwiKSlcbiAgICAgICAgICByb3crPVwieFwiO1xuICAgICAgICBlbHNlIGlmKHBvc2l0aW9uLmNsYXNzTGlzdC5jb250YWlucyhcIm9cIikpXG4gICAgICAgICAgcm93Kz1cIm9cIjtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIHJvdys9XCJiXCI7XG4gICAgICB9XG4gICAgICBnYW1lUG9zaXRpb25zLnB1c2gocm93KTtcbiAgICB9XG4gICAgY29uc29sZS5sb2coZ2FtZVBvc2l0aW9ucyk7XG4gICAgcmV0dXJuIGdhbWVQb3NpdGlvbnM7XG4gIH07XG5cbiAgZm9yKHZhciBpPTA7aTxidXR0b25zLmxlbmd0aDtpKyspe1xuICAgIGJ1dHRvbnNbaV0ub25jbGljaz1idXR0b25DbGlja0hhbmRsZXI7XG4gIH1cblxufVxuIl19
