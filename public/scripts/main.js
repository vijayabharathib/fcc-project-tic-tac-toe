function setupPlayerOption(){function e(){var e=Math.floor(3*Math.random())+1,o=Math.floor(3*Math.random())+1,t=document.querySelector("#r"+e+"c"+o);t.classList.add("x")}var o=function(){for(var o=document.querySelectorAll(".game button"),t=0;t<o.length;t++)o[t].classList.remove("reset");bot=this.classList.contains("x")?"o":"x",player="x"===bot?"o":"x";var r=document.querySelector(".game");r.classList.remove("off"),r.classList.add("on");var s=document.querySelector(".status");s.innerText="Game on","x"===bot?e():s.innerText="Your move"},t=document.querySelectorAll(".player");t[0].onclick=o,t[1].onclick=o}function processPlayerInput(){function e(){result="Game on";var e=document.querySelector(".status");return positions=l(),winner=i(positions),winner?(n(winner),winner[0]===bot?(result="Bot ("+bot.toUpperCase()+") wins.",e.classList.add("lost")):(result="You ("+player.toUpperCase()+") win!",e.classList.add("won")),u(),window.setTimeout(o,3e3)):t()&&(result="It's a tie!",e.classList.add("tie"),u(),window.setTimeout(o,3e3)),e.innerText=result,result}function o(){bot="b",player="b";var e=document.querySelector(".game");e.classList.remove("on"),e.classList.add("off");for(var o=document.querySelectorAll(".game button"),t=0;t<o.length;t++)o[t].classList.add("reset"),o[t].classList.remove("x"),o[t].classList.remove("o"),o[t].classList.remove("won"),o[t].classList.remove("lost");var r=document.querySelector(".status");r.classList.remove("won"),r.classList.remove("tie"),r.classList.remove("lost"),r.innerText="..."}function t(){return positions=l(),winner=i(positions),!winner&&!positions.toString().includes("b")}function s(){positions=l();var e=[bot+bot+"b",bot+"b"+bot,"b"+bot+bot],o=a(positions,e);if(!o){var t=[player+player+"b",player+"b"+player,"b"+player+player];o=a(positions,t)}if(!o){var r=[bot+"bb","bb"+bot,"b"+bot+"b"];o=a(positions,r)}if(!o){var s=[player+"bb","bb"+player,"b"+player+"b"];o=a(positions,s)}if(!o){var n=[player+"b"+bot,bot+"b"+player,"b"+player+bot,"b"+bot+player,bot+player+"b",player+bot+"b"];o=a(positions,n)}}function n(e){var o=e[0]===bot?"lost":"won";if(e[1]==e[3]||e[2]==e[4])for(var t=e[1];t<=e[3];t++)for(var r=e[2];r<=e[4];r++){var s=document.querySelector("#r"+t+"c"+r);s.classList.add(o)}else if(1==e[1]&&3==e[2])for(var n=1;n<4;n++){var s=document.querySelector("#r"+n+"c"+(4-n));s.classList.add(o)}else if(1==e[1]&&1==e[2])for(var n=1;n<4;n++){var s=document.querySelector("#r"+n+"c"+n);s.classList.add(o)}}function a(e,o){for(var t=!1,s=0;s<3;s++){var n=e[0][s]+e[1][s]+e[2][s];o.includes(e[s])?(c=e[s].indexOf("b")+1,r=s+1,t=[r,c]):o.includes(n)&&(r=n.indexOf("b")+1,c=s+1,t=[r,c])}var a=e[0][0]+e[1][1]+e[2][2],i=e[0][2]+e[1][1]+e[2][0];if(o.includes(a)){var l=a.indexOf("b");r=l+1,c=l+1,t=[r,c]}else if(o.includes(i)){var l=i.indexOf("b");c=3-l,r=l+1,t=[r,c]}if(t){var u=document.querySelector("#r"+t[0]+"c"+t[1]);u.classList.add(bot)}return t}function i(e){for(var o=!1,t=0;t<3;t++){var r=e[0][t]+e[1][t]+e[2][t];if("xxx"===e[t]?o=["x",t+1,1,t+1,3]:"ooo"===e[t]?o=["o",t+1,1,t+1,3]:"xxx"===r?o=["x",1,t+1,3,t+1]:"ooo"===r&&(o=["o",1,t+1,3,t+1]),o)break}var s=e[0][0]+e[1][1]+e[2][2],n=e[0][2]+e[1][1]+e[2][0];return o||("xxx"===s?o=["x",1,1,3,3]:"xxx"===n?o=["x",1,3,3,1]:"ooo"===s?o=["o",1,1,3,3]:"ooo"===n&&(o=["o",1,3,3,1])),o}function l(){for(var e=[],o=1;o<4;o++){for(var t="",r=1;r<4;r++){var s=document.querySelector("#r"+o+"c"+r);t+=s.classList.contains("x")?"x":s.classList.contains("o")?"o":"b"}e.push(t)}return e}function u(){var e=new Audio("public/audio/chime.ogg");e.play()}for(var d=function(){var o=l(),t=i(o);if(!t&&!this.classList.contains("x")&&!this.classList.contains("o")){this.classList.add(player);var r=e();"Game on"==r&&(s(),e())}},b=document.querySelectorAll(".game button"),p=0;p<b.length;p++)b[p].onclick=d}function setupKeyHandlers(){document.onkeypress=function(e){var o=parseInt(e.key),t=document.querySelector(".game"),r=!t.classList.contains("off");if("X"!=e.key.toUpperCase()||r)if("O"!=e.key.toUpperCase()||r){if(r&&o>0&&o<10){var s="#r"+Math.ceil(o/3);s+="c"+(o%3==0?3:o%3),document.querySelector(s).click()}}else document.querySelector(".player.o").click();else document.querySelector(".player.x").click()}}var player="b",bot="b";document.addEventListener("DOMContentLoaded",function(e){setupPlayerOption(),processPlayerInput(),setupKeyHandlers()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsic2V0dXBQbGF5ZXJPcHRpb24iLCJmaXJzdE1vdmUiLCJyIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiYyIsInJhbmQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjbGFzc0xpc3QiLCJhZGQiLCJwbGF5ZXJDaG9pY2UiLCJidXR0b25zIiwicXVlcnlTZWxlY3RvckFsbCIsImkiLCJsZW5ndGgiLCJyZW1vdmUiLCJib3QiLCJ0aGlzIiwiY29udGFpbnMiLCJwbGF5ZXIiLCJnYW1lIiwic3RhdHVzIiwiaW5uZXJUZXh0IiwicGxheWVyT3B0aW9ucyIsIm9uY2xpY2siLCJwcm9jZXNzUGxheWVySW5wdXQiLCJldmFsdWF0ZUdhbWVTdGF0dXMiLCJyZXN1bHQiLCJwb3NpdGlvbnMiLCJnZXRHYW1lUG9zaXRpb25zIiwid2lubmVyIiwiZ2V0V2lubmVyIiwiZm9ybWF0V2lubmVyIiwidG9VcHBlckNhc2UiLCJjaGltZSIsIndpbmRvdyIsInNldFRpbWVvdXQiLCJyZXNldEdhbWUiLCJnYW1lVGllIiwidG9TdHJpbmciLCJpbmNsdWRlcyIsImJvdFJlc3BvbnNlIiwid2luUGF0dGVybnMiLCJuZXh0IiwiZmlsbE5leHRCZXN0U2xvdCIsImRlZmVuY2VQYXR0ZXJucyIsInN0cmF0ZWdpY1dpblBhdHRlcm5zIiwic3RyYXRlZ2ljRGVmZW5jZVBhdHRlcm5zIiwib25lTGFzdFNsb3RQYXR0ZXJucyIsImhpZ2hsaWdodCIsImJsb2NrIiwicGF0dGVybnMiLCJjb2x1bW4iLCJpbmRleE9mIiwiZGlhZzEiLCJkaWFnMiIsImluZGV4IiwibmV4dEJsb2NrIiwiZ2FtZVBvc2l0aW9ucyIsInJvdyIsImoiLCJwb3NpdGlvbiIsInB1c2giLCJBdWRpbyIsInBsYXkiLCJidXR0b25DbGlja0hhbmRsZXIiLCJnYW1lU3RhdHVzIiwic2V0dXBLZXlIYW5kbGVycyIsIm9ua2V5cHJlc3MiLCJldmVudCIsImJsb2NrTnVtIiwicGFyc2VJbnQiLCJrZXkiLCJnYW1lT24iLCJibG9ja0lEIiwiY2VpbCIsImNsaWNrIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiXSwibWFwcGluZ3MiOiJBQW1CQSxRQUFTQSxxQkErQlAsUUFBU0MsS0FDUCxHQUFJQyxHQUFFQyxLQUFLQyxNQUFvQixFQUFkRCxLQUFLRSxVQUFZLEVBQzlCQyxFQUFFSCxLQUFLQyxNQUFvQixFQUFkRCxLQUFLRSxVQUFZLEVBQzlCRSxFQUFLQyxTQUFTQyxjQUFjLEtBQU1QLEVBQUksSUFBS0ksRUFDL0NDLEdBQUtHLFVBQVVDLElBQUksS0EvQnJCLEdBQUlDLEdBQWEsV0FHZixJQUFJLEdBREFDLEdBQVFMLFNBQVNNLGlCQUFpQixnQkFDOUJDLEVBQUUsRUFBRUEsRUFBRUYsRUFBUUcsT0FBT0QsSUFDM0JGLEVBQVFFLEdBQUdMLFVBQVVPLE9BQU8sUUFHOUJDLEtBQUtDLEtBQUtULFVBQVVVLFNBQVMsS0FBUSxJQUFNLElBQzNDQyxPQUFjLE1BQU5ILElBQWEsSUFBTSxHQUUzQixJQUFJSSxHQUFLZCxTQUFTQyxjQUFjLFFBQ2hDYSxHQUFLWixVQUFVTyxPQUFPLE9BQ3RCSyxFQUFLWixVQUFVQyxJQUFJLEtBRW5CLElBQUlZLEdBQU9mLFNBQVNDLGNBQWMsVUFDbENjLEdBQU9DLFVBQVUsVUFFUixNQUFOTixJQUNEakIsSUFFQXNCLEVBQU9DLFVBQVUsYUFlakJDLEVBQWNqQixTQUFTTSxpQkFBaUIsVUFDNUNXLEdBQWMsR0FBR0MsUUFBUWQsRUFDekJhLEVBQWMsR0FBR0MsUUFBUWQsRUFVM0IsUUFBU2Usc0JBOEJQLFFBQVNDLEtBQ1BDLE9BQU8sU0FDUCxJQUFJTixHQUFPZixTQUFTQyxjQUFjLFVBOEJsQyxPQTVCQXFCLFdBQVVDLElBQ1ZDLE9BQU9DLEVBQVVILFdBRWRFLFFBTURFLEVBQWFGLFFBQ1ZBLE9BQU8sS0FBS2QsS0FDYlcsT0FBTyxRQUFTWCxJQUFJaUIsY0FBZ0IsVUFDcENaLEVBQU9iLFVBQVVDLElBQUksVUFFckJrQixPQUFPLFFBQVVSLE9BQU9jLGNB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QTBDIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAgKiB3YWl0IHVudGlsIHRoZSBkb2MgaXMgcmVhZHkgdG8gb2JleSBvcmRlcnNcbiAgKi9cbiAgdmFyIHBsYXllcj1cImJcIjsgLy9zdGFydCB3aXRoIGJsYW5rXG4gIHZhciBib3Q9XCJiXCI7IC8vc3RhcnQgd2l0aCBibGFua1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIixmdW5jdGlvbihlKXtcbiAgLyoqXG4gICAgKiBvbmNlIGNvbnRlbnQgaXMgbG9hZGVkXG4gICAgKi9cbiAgc2V0dXBQbGF5ZXJPcHRpb24oKTtcbiAgcHJvY2Vzc1BsYXllcklucHV0KCk7XG4gIHNldHVwS2V5SGFuZGxlcnMoKTtcbn0pO1xuXG4vKipcbiAgKiBoYW5kbGUgcGxheWVyIGNob2ljZSBvZiB4IG9yIG8gYXQgdGhlIHN0YXJ0IG9mIGVhY2ggZ2FtZVxuICAqIGdldCB0aGUgZ2FtZSBib2FyZCByZWFkeVxuICAqIGxldCB0aGUgYm90IG1ha2UgZmlyc3QgbW92ZSBpZiBwbGF5ZXIgY2hvc2VzIHRvIGJlICdvJ1xuICAqL1xuZnVuY3Rpb24gc2V0dXBQbGF5ZXJPcHRpb24oKXtcblxuICAvL2NhbGxlZCB0byBoYW5kbGUgdXNlciBjaG9pY2UgYmVmb3JlIGVhY2ggZ2FtZVxuICAvL2Fsc28gc3RhcnRzIHRoZSBnYW1lIGlmIGJvdCBoYXMgdG8gbWFrZSBmaXJzdCBtb3ZlXG4gIHZhciBwbGF5ZXJDaG9pY2U9ZnVuY3Rpb24oKXtcbiAgICAvLyBzdGFydCB0aGUgZ2FtZSBieSByZXZlYWxpbmcgdGhlIGJvYXJkXG4gICAgdmFyIGJ1dHRvbnM9ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5nYW1lIGJ1dHRvblwiKTtcbiAgICBmb3IodmFyIGk9MDtpPGJ1dHRvbnMubGVuZ3RoO2krKyl7XG4gICAgICBidXR0b25zW2ldLmNsYXNzTGlzdC5yZW1vdmUoXCJyZXNldFwiKTtcbiAgICB9XG4gICAgLy9yZW1lbWJlciBwbGF5ZXIgY2hvaWNlIGFuZCBkZXRlcm1pbmUgb3B0aW9uIGZvciBib3RcbiAgICBib3Q9KHRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKFwieFwiKSkgPyBcIm9cIiA6IFwieFwiO1xuICAgIHBsYXllcj0oYm90PT09XCJ4XCIpID8gXCJvXCIgOiBcInhcIjtcbiAgICAvLyBjbG9uZSBvcHRpb24gcGFuZWxcbiAgICB2YXIgZ2FtZT1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2FtZScpO1xuICAgIGdhbWUuY2xhc3NMaXN0LnJlbW92ZSgnb2ZmJyk7XG4gICAgZ2FtZS5jbGFzc0xpc3QuYWRkKCdvbicpO1xuICAgIC8vIHNldCB0aGUgcHJvcGVyIHN0YXR1cyBmb3IgdXNlciBleHBlcmllbmNlXG4gICAgdmFyIHN0YXR1cz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3RhdHVzJyk7XG4gICAgc3RhdHVzLmlubmVyVGV4dD1cIkdhbWUgb25cIjtcbiAgICAvL21ha2UgYSBtb3ZlIC1PUi0gYXNrIHRoZSBwbGF5ZXIgdG8gc3RhcnRcbiAgICBpZihib3Q9PT1cInhcIilcbiAgICAgIGZpcnN0TW92ZSgpO1xuICAgIGVsc2VcbiAgICAgIHN0YXR1cy5pbm5lclRleHQ9XCJZb3VyIG1vdmVcIjtcbiAgfTtcblxuICAvKipcbiAgICAqIG1ha2UgYSByYW5kb20gcGljayBpZiBib3QgcGxheXMgZmlyc3RcbiAgICAqIGVhY2ggYmxvY2sgaGFzICNyWGNZIGlkIGhvb2sgbGlrZSAjcjFjMVxuICAgICovXG4gIGZ1bmN0aW9uIGZpcnN0TW92ZSgpe1xuICAgIHZhciByPU1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSozKSsxO1xuICAgIHZhciBjPU1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSozKSsxO1xuICAgIHZhciByYW5kPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjclwiKyByICsgXCJjXCIgK2MpO1xuICAgIHJhbmQuY2xhc3NMaXN0LmFkZChcInhcIik7IC8vIGFkZCBib3QgY2xhc3NcbiAgfTtcblxuICAvL2NhbGwgcGxheWVyIGNob2ljZSwgb25jZSB0aGUgdXNlciBtYWtlcyBhIHNlbGVjdGlvblxuICB2YXIgcGxheWVyT3B0aW9ucz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGxheWVyJyk7XG4gIHBsYXllck9wdGlvbnNbMF0ub25jbGljaz1wbGF5ZXJDaG9pY2U7XG4gIHBsYXllck9wdGlvbnNbMV0ub25jbGljaz1wbGF5ZXJDaG9pY2U7XG5cbn1cblxuLyoqXG4gICogcHJvY2VzcyB1c2VyIHNlbGVjdGlvbiBkdXJpbmcgZ2FtZVxuICAqIGRldGVybWluZSBpZiB0aGUgZ2FtZSBpcyBvdmVyXG4gICogaWYgdGhlIGdhbWUgaXMgc3RpbGwgb24sIHNlbmQgYm90J3MgcmVzcG9uc2VcbiAgKiBhbmQgZXZhbHVhdGUgaWYgdGhlIGdhbWUgaXMgc3RpbGwgb24uXG4gICovXG5mdW5jdGlvbiBwcm9jZXNzUGxheWVySW5wdXQoKXtcbiAgLyoqXG4gICAgKiBoYW5kbGUgdXNlciBjbGljayBvbiB0aGUgZ2FtZSBibG9ja3NcbiAgICAqL1xuICB2YXIgYnV0dG9uQ2xpY2tIYW5kbGVyPWZ1bmN0aW9uKCl7XG4gICAgLy9nZXQgY3VycmVudCBib2FyZCBwb3NpdGlvbnNcbiAgICB2YXIgcG9zaXRpb25zPWdldEdhbWVQb3NpdGlvbnMoKTtcbiAgICAvL2NoZWNrIGZvciB3aW5uZXIgcG9zaXRpb25zXG4gICAgdmFyIHdpbm5lcj1nZXRXaW5uZXIocG9zaXRpb25zKTtcbiAgICAvLyBkbyBub3RoaW5nIGlmIHRoZSBibG9jayBhbHJlYWR5IGhhcyB4IG9yIG8gKGFuZCB0aGUgZ2FtZSBpcyBzdGlsbCBvbilcbiAgICBpZighd2lubmVyICYmICF0aGlzLmNsYXNzTGlzdC5jb250YWlucyhcInhcIikgJiYgIXRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKFwib1wiKSl7XG4gICAgICB0aGlzLmNsYXNzTGlzdC5hZGQocGxheWVyKTtcbiAgICAgIHZhciBnYW1lU3RhdHVzPWV2YWx1YXRlR2FtZVN0YXR1cygpOyAvL2V2YWx1YXRlIHRoZSBib2FyZCBmb3IgdXNlciBpbnB1dFxuICAgICAgaWYoZ2FtZVN0YXR1cz09XCJHYW1lIG9uXCIpe1xuICAgICAgICBib3RSZXNwb25zZSgpOyAvL2lmIHRoZSBnYW1lIGlzIHN0aWxsIGluIHByb2dyZXNzLCByZXNwb25kIGJhY2sgd2l0aCBzZWxlY3Rpb25cbiAgICAgICAgZXZhbHVhdGVHYW1lU3RhdHVzKCk7IC8vZXZhbHVhdGUgdGhlIGJvYXJkIGZvciBib3QgcmVzcG9uc2VcbiAgICAgIH1cbiAgICB9XG5cblxuICB9O1xuXG4gIC8qKlxuICAgICogZXZhbHVhdGUgdGhlIGJvYXJkIGZvciBjdXJyZW50IHN0YXR1c1xuICAgICogcG9zc2libGUgZ2FtZSBzdGF0dXNcbiAgICAqIC0tIFwiR2FtZSBvblwiIC0tZGVmYXVsdFxuICAgICogLS0gXCJZb3Ugd2luXCJcbiAgICAqIC0tIFwiQm90IHdpbnNcIlxuICAgICogLS0gXCJJdCdzIGEgdGllXCJcbiAgICAqL1xuICBmdW5jdGlvbiBldmFsdWF0ZUdhbWVTdGF0dXMoKXtcbiAgICByZXN1bHQ9XCJHYW1lIG9uXCI7XG4gICAgdmFyIHN0YXR1cz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3RhdHVzJyk7XG5cbiAgICBwb3NpdGlvbnM9Z2V0R2FtZVBvc2l0aW9ucygpOyAvL2dldCBwb3NpdGlvbnMgYWdhaW4sIGJhc2VkIG9uIGxhc3QgdXNlciBpbnB1dFxuICAgIHdpbm5lcj1nZXRXaW5uZXIocG9zaXRpb25zKTtcblxuICAgIGlmKHdpbm5lcil7XG4gICAgICAvKipcbiAgICAgICAgKiBpZiBlaXRoZXIgdGhlIHBsYXllciBvciB0aGUgYm90IGhhcyB3b25cbiAgICAgICAgKiBmb3JtYXQgdGhlIGJvYXJkIGFuZCBzZW5kIHRoZSBzdGF0dXMgYmFja1xuICAgICAgICAqIGNhbGwgYmFjayByZXNldEdhbWUgdG8gZ2V0IHJlYWR5IGZvciBuZXh0IGdhbWVcbiAgICAgICAgKi9cbiAgICAgIGZvcm1hdFdpbm5lcih3aW5uZXIpO1xuICAgICAgaWYod2lubmVyWzBdPT09Ym90KXtcbiAgICAgICAgcmVzdWx0PVwiQm90IChcIisgYm90LnRvVXBwZXJDYXNlKCkgKyBcIikgd2lucy5cIjtcbiAgICAgICAgc3RhdHVzLmNsYXNzTGlzdC5hZGQoXCJsb3N0XCIpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHJlc3VsdD1cIllvdSAoXCIgKyBwbGF5ZXIudG9VcHBlckNhc2UoKSArIFwiKSB3aW4hXCI7XG4gICAgICAgIHN0YXR1cy5jbGFzc0xpc3QuYWRkKFwid29uXCIpO1xuICAgICAgfVxuICAgICAgY2hpbWUoKTtcbiAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KHJlc2V0R2FtZSwzMDAwKTtcbiAgICB9ZWxzZSBpZiAoZ2FtZVRpZSgpKXtcbiAgICAgIC8vaWYgaXQncyBhIHRpZSBjYWxsIGJhY2sgcmVzZXRHYW1lIHRvIGdldCByZWFkeSBmb3IgbmV4dCBnYW1lXG4gICAgICByZXN1bHQ9XCJJdCdzIGEgdGllIVwiO1xuICAgICAgc3RhdHVzLmNsYXNzTGlzdC5hZGQoXCJ0aWVcIik7IC8vY2FsbCBmb3IgYXR0ZW50aW9uXG4gICAgICBjaGltZSgpO1xuICAgICAgd2luZG93LnNldFRpbWVvdXQocmVzZXRHYW1lLDMwMDApO1xuICAgIH1cbiAgICAvL3VwZGF0ZSBzdGF0dXMgZmllbGRcbiAgICBzdGF0dXMuaW5uZXJUZXh0PXJlc3VsdDtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLy9nZXQgcmVhZHkgZm9yIHRoZSBuZXh0IGdhbWVcbiAgZnVuY3Rpb24gcmVzZXRHYW1lKCl7XG4gICAgLy9yZXNldCBwbGF5ZXIgY2hvaWNlXG4gICAgYm90PVwiYlwiO1xuICAgIHBsYXllcj1cImJcIjtcbiAgICAvKipcbiAgICAgICogc2V0IHRoZSBmbGFnIHRvIGdhbWUgb2ZmXG4gICAgICAqIHRoaXMgd2lsbCBoaWRlIHRoZSBib2FyZCBhbmQgc2hvdyB0aGUgb3B0aW9uIHBhbmVsXG4gICAgICAqIGZvciB1c2VyIHRvIG1ha2UgYSBjaG9pY2UgYWdhaW5cbiAgICAgICovXG4gICAgdmFyIGdhbWU9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbWUnKTtcbiAgICBnYW1lLmNsYXNzTGlzdC5yZW1vdmUoJ29uJyk7XG4gICAgZ2FtZS5jbGFzc0xpc3QuYWRkKCdvZmYnKTtcbiAgICAvKipcbiAgICAgICogcmVtb3ZlIGVhcmxpZXIgcGxheWVyIGFuZCBib3Qgc2VsZWN0aW9ucyBmcm9tIGJsb2Nrc1xuICAgICAgKiBhZGQgcmVzZXQgY2xhc3MgZm9yIHV4XG4gICAgICAqIHJlbW92ZSB3aW4gY2xhc3MgdG8gcmVzZXQgYW55IGhpZ2hsaWdodHMgb2Ygd29uIGJsb2NrIG9yZGVyXG4gICAgICAqL1xuICAgIHZhciBidXR0b25zPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZ2FtZSBidXR0b25cIik7XG4gICAgZm9yKHZhciBpPTA7aTxidXR0b25zLmxlbmd0aDtpKyspe1xuICAgICAgYnV0dG9uc1tpXS5jbGFzc0xpc3QuYWRkKFwicmVzZXRcIik7XG4gICAgICBidXR0b25zW2ldLmNsYXNzTGlzdC5yZW1vdmUoXCJ4XCIpO1xuICAgICAgYnV0dG9uc1tpXS5jbGFzc0xpc3QucmVtb3ZlKFwib1wiKTtcbiAgICAgIGJ1dHRvbnNbaV0uY2xhc3NMaXN0LnJlbW92ZShcIndvblwiKTtcbiAgICAgIGJ1dHRvbnNbaV0uY2xhc3NMaXN0LnJlbW92ZShcImxvc3RcIik7XG4gICAgfVxuICAgIC8vcmVzZXQgc3RhdHVzIGZpZWxkXG4gICAgdmFyIHN0YXR1cz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3RhdHVzJyk7XG4gICAgc3RhdHVzLmNsYXNzTGlzdC5yZW1vdmUoXCJ3b25cIik7XG4gICAgc3RhdHVzLmNsYXNzTGlzdC5yZW1vdmUoXCJ0aWVcIik7XG4gICAgc3RhdHVzLmNsYXNzTGlzdC5yZW1vdmUoXCJsb3N0XCIpO1xuICAgIHN0YXR1cy5pbm5lclRleHQ9XCIuLi5cIjtcbiAgfVxuXG4gIC8vYm9vbGVhbiBhbnN3ZXIgXCJpcyBpdCBhIHRpZT9cIiAodHJ1ZSAvIGZhbHNlIClcbiAgZnVuY3Rpb24gZ2FtZVRpZSgpe1xuICAgIHBvc2l0aW9ucz1nZXRHYW1lUG9zaXRpb25zKCk7XG4gICAgd2lubmVyPWdldFdpbm5lcihwb3NpdGlvbnMpO1xuICAgIC8vbm8gb25lIGhhcyB3b24gYW5kIG5vIGJsYW5rcyAoYWxsIGJsb2NrcyBmaWxsZWQgaW4pXG4gICAgcmV0dXJuICghd2lubmVyICYmICFwb3NpdGlvbnMudG9TdHJpbmcoKS5pbmNsdWRlcyhcImJcIikpO1xuICB9XG5cbiAgLyoqXG4gICAgKiB0aGUgYnJhaW4gb2YgdGhlIGJvdFxuICAgICogZmlyc3QsIHRyeSB0byB3aW4sIHRoaXMgaXMgaW1wb3J0YW50XG4gICAgKiAgZG9uJ3QgZ2l2ZSBhbm90aGVyIG9wdGlvbiBmb3IgdGhlIHBsYXllclxuICAgICogc2Vjb25kLCB0cnkgdG8gZGVmZW5kLCBjdXQgb2ZmIHBsYXllciBmcm9tIHdpbm5pbmcgaW4gdGhlIG5leHQgbW92ZVxuICAgICogdGhpcmQsIGluIGFudGljaXBhdGlvbiB0byB3aW4gaW4gdGhlIG5leHQgbW92ZSwgY3JlYXRlIGEgc2VyaWVzXG4gICAgKiBmb3VydGgsIGluIGVhcmx5IHN0YWdlcyBvZiB0aGUgZ2FtZSwgc3RheSBjbG9zZSB0byB0aGUgcGxheWVyXG4gICAgKiBmaWZ0aCwgbG9va3MgbGlrZSB0aGUgZ2FtZSBpcyBhbG1vc3QgYXQgdGhlIGVuZCwgbWF5IGJlIG9uZSBibG9jayBsZWZ0XG4gICAgKiAganVzdCBmaWxsIGl0IGluLlxuICAgICovXG4gIGZ1bmN0aW9uIGJvdFJlc3BvbnNlKCl7XG4gICAgcG9zaXRpb25zPWdldEdhbWVQb3NpdGlvbnMoKTsgLy9nZXQgY3VycmVudCBnYW1lIHBvc2l0aW9uc1xuICAgIC8vdHJ5IHRvIHdpbiBmaXJzdFxuICAgIHZhciB3aW5QYXR0ZXJucz1bYm90K2JvdCtcImJcIixib3QrXCJiXCIrYm90LFwiYlwiK2JvdCtib3RdO1xuICAgIHZhciBuZXh0PWZpbGxOZXh0QmVzdFNsb3QocG9zaXRpb25zLHdpblBhdHRlcm5zKTtcbiAgICBpZighbmV4dCl7IC8vdHJ5aWcgdG8gd2luIHdhcyBub3Qgc3VjY2Vzc2Z1bFxuICAgICAgLy9zZWNvbmQgaXMgdG8gdHJ5IGFuZCBkZWZlbmRcbiAgICAgIHZhciBkZWZlbmNlUGF0dGVybnM9W3BsYXllcitwbGF5ZXIrXCJiXCIscGxheWVyK1wiYlwiK3BsYXllcixcImJcIitwbGF5ZXIrcGxheWVyXTtcbiAgICAgIG5leHQ9ZmlsbE5leHRCZXN0U2xvdChwb3NpdGlvbnMsZGVmZW5jZVBhdHRlcm5zKTtcbiAgICB9XG4gICAgaWYoIW5leHQpey8vZGVmZW5kIHdhcyBub3QgcG9zc2libGUsIG1heSBiZSB0b28gZWFybHlcbiAgICAgIC8vdGhpcmQsIHRyeSB0byBwb3NpdGlvbiBib3Qgc2lkZSBieSBzaWRlLCBpbiByZWFkaW5lc3MgZm9yIG5leHQgd2luXG4gICAgICB2YXIgc3RyYXRlZ2ljV2luUGF0dGVybnM9W2JvdCtcImJiXCIsXCJiYlwiK2JvdCxcImJcIitib3QrXCJiXCJdO1xuICAgICAgbmV4dD1maWxsTmV4dEJlc3RTbG90KHBvc2l0aW9ucyxzdHJhdGVnaWNXaW5QYXR0ZXJucyk7XG4gICAgfVxuICAgIGlmKCFuZXh0KXsvL211c3QgYmUgZWFybHkgc3RhZ2VzLCBwb3NpdGlvbiBmb3IgdGhlIGJlbmVmaXQgb2YgYm90IHdhcyBub3QgcG9zc2libGVcbiAgICAgIC8vdHJ5IHRvIHBvc2l0aW9uIHJpZ2h0IG5leHQgdG8gdGhlIHBsYXllciAtIHdoeT8gSXQganVzdCBoZWxwIGJsb2NrIHBsYXllcidzIHNlcXVlbmNlIFtubyBwcm9vZl1cbiAgICAgIHZhciBzdHJhdGVnaWNEZWZlbmNlUGF0dGVybnM9W3BsYXllcitcImJiXCIsXCJiYlwiK3BsYXllcixcImJcIitwbGF5ZXIrXCJiXCJdO1xuICAgICAgbmV4dD1maWxsTmV4dEJlc3RTbG90KHBvc2l0aW9ucyxzdHJhdGVnaWNEZWZlbmNlUGF0dGVybnMpO1xuICAgIH1cbiAgICBpZighbmV4dCl7IC8vYWxsIGlzIGxvc3QgYW5kIGxvb2tzIGxpa2Ugb25lIGxhc3QgcG9zaXRpb24gbGVmdCBvdXRcbiAgICAgIHZhciBvbmVMYXN0U2xvdFBhdHRlcm5zPVtcbiAgICAgICAgcGxheWVyK1wiYlwiK2JvdCxcbiAgICAgICAgYm90K1wiYlwiK3BsYXllcixcbiAgICAgICAgXCJiXCIrcGxheWVyK2JvdCxcbiAgICAgICAgXCJiXCIrYm90K3BsYXllcixcbiAgICAgICAgYm90K3BsYXllcitcImJcIixcbiAgICAgICAgcGxheWVyK2JvdCtcImJcIlxuICAgICAgXTtcbiAgICAgIG5leHQ9ZmlsbE5leHRCZXN0U2xvdChwb3NpdGlvbnMsb25lTGFzdFNsb3RQYXR0ZXJucyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAgKiBmb3JtYXQgd2lubmVyIG9yZGVyXG4gICAgKi9cbiAgZnVuY3Rpb24gZm9ybWF0V2lubmVyKHdpbm5lcil7XG4gICAgLy9kaWZmZXJlbnQgaGlnaGxpZ2h0cyBmb3Igd29uL2xvc3Qgc2l0dWF0aW9uXG4gICAgLy9yZXNvbHZlZCBhbnN3ZXIgZm9yIGhpZ2hsaWdodCBpcyBjbGFzcyBuYW1lIGZvciBzdHlsaW5nXG4gICAgdmFyIGhpZ2hsaWdodD0od2lubmVyWzBdPT09Ym90KT8gXCJsb3N0XCI6XCJ3b25cIjtcbiAgICAvKipcbiAgICAgICogd2lubmVyIGFycmF5IGhhcyB0aGUgZm9sbG93aW5nIGZvcm1hdFxuICAgICAgKiB3aW5uZXIgPSBbXCJ3aW5uZXIgY2hhcmFjdGVyXCIsXG4gICAgICAqICAgXCJyb3cgaW5kZXggb2Ygc3RhcnRpbmcgYmxvY2tcIlxuICAgICAgKiAgIFwiY29sIGluZGV4IG9mIHN0YXJ0aWduIGJsb2NrXCIsXG4gICAgICAqICAgXCJyb3cgaW5kZXggb2YgZW5kIGJsb2NrXCIsXG4gICAgICAqICAgXCJjb2wgaW5kZXggb2YgZW5kIGJsb2NrXCJdXG4gICAgICAqIGZvciBlLmcsIHdpbm5lcj1bXCJ4XCIsMSwzLDMsMV0gLSBib3R0b20gbGVmdCB0byB0b3AgcmlnaHRcbiAgICAgICovXG4gICAgaWYod2lubmVyWzFdPT13aW5uZXJbM10gfHwgd2lubmVyWzJdPT13aW5uZXJbNF0peyAvL3JvdyBvciBjb2x1bW5cbiAgICAgIGZvcih2YXIgcj13aW5uZXJbMV07cjw9d2lubmVyWzNdO3IrKyl7XG4gICAgICAgIGZvcih2YXIgYz13aW5uZXJbMl07Yzw9d2lubmVyWzRdO2MrKyl7XG4gICAgICAgICAgdmFyIGJsb2NrPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjclwiICsgciArIFwiY1wiICsgYyk7XG4gICAgICAgICAgYmxvY2suY2xhc3NMaXN0LmFkZChoaWdobGlnaHQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfWVsc2UgaWYod2lubmVyWzFdPT0xICYmIHdpbm5lclsyXT09Myl7IC8vYm90dG9tIGxlZnQgdG8gdG9wIHJpZ2h0XG4gICAgICBmb3IodmFyIGk9MTtpPDQ7aSsrKXtcbiAgICAgICAgLy8gb25seSBpbiB0aGlzIHNjZW5hcmlvLCBjb2x1bW4gaW5kZXggcmVkdWNlcyBhcyByb3cgaW5jcmVhc2VzXG4gICAgICAgIC8vaGVuY2UgNC1pIHVzZWQgdG8gZmluZCB0aGUgY29sdW1uIGluZGV4XG4gICAgICAgIHZhciBibG9jaz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JcIiArIGkgKyBcImNcIiArICg0LWkpKTtcbiAgICAgICAgYmxvY2suY2xhc3NMaXN0LmFkZChoaWdobGlnaHQpO1xuICAgICAgfVxuICAgIH1lbHNlIGlmKHdpbm5lclsxXT09MSAmJiB3aW5uZXJbMl09PTEpeyAvL3RvcCBsZWZ0IHRvIGJvdHRvbSByaWdodFxuICAgICAgZm9yKHZhciBpPTE7aTw0O2krKyl7XG4gICAgICAgIHZhciBibG9jaz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JcIiArIGkgKyBcImNcIiArIGkpO1xuICAgICAgICBibG9jay5jbGFzc0xpc3QuYWRkKGhpZ2hsaWdodCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAgKiBsb29rIGZvciBwcm92aWRlZCBwYXR0ZXJzIGluIHRoZSBjdXJyZW50IHBvc2l0aW9uc1xuICAgICogYW5kIHJldHVybiBiZXN0IHNsb3QgdGhhdCBtYXRjaGVzIHRoZSBwYXR0ZXJuXG4gICAgKiByZXR1cm4gZmFsc2UgaWYgbm8gc3VjaCBtYXRjaFxuICAgICogc2FtcGxlIHBvc2l0aW9uczogW1wieHhiXCIsXCJvb2JcIixcInhib1wiXVxuICAgICogc2FtcGxlIGRlc2lyZWQgcGF0dGVybnMgW1wieHhiXCIsXCJ4YnhcIixcImJ4eFwiXVxuICAgICogYWJvdmUgc2FtcGxlcyAgd2lsbCBoZWxwIHBsYXllciB4IHdpbiB0aGUgZ2FtZSBpbiB0aGlzIGV4YW1wbGVcbiAgICAqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICAqIGIgcmVwcmVzZW50cyBibGFua3MgKipcbiAgICAqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICAqL1xuICBmdW5jdGlvbiBmaWxsTmV4dEJlc3RTbG90KHBvc2l0aW9ucyxwYXR0ZXJucyl7XG4gICAgLy9sb29rIGZvciBjb21wbGV0ZWQgcm93cyBvciBjb2x1bW5zIGluIHBvc2l0aW9uc1xuICAgIC8vcmV0dXJuIHRoZSB3aW5uZXIgaWYgZm91bmRcbiAgICB2YXIgcmVzdWx0PWZhbHNlO1xuICAgIGZvcih2YXIgaT0wO2k8MztpKyspe1xuICAgICAgdmFyIGNvbHVtbj1wb3NpdGlvbnNbMF1baV0rcG9zaXRpb25zWzFdW2ldK3Bvc2l0aW9uc1syXVtpXTtcbiAgICAgIC8vY2hlY2sgaWYgY3VycmVudCByb3cgbWF0Y2hlcyBhdCBsZWFzdCBvbmUgb2YgdGhlIGRlc2lyZWQgcGF0dGVybnNcbiAgICAgIGlmKHBhdHRlcm5zLmluY2x1ZGVzKHBvc2l0aW9uc1tpXSkpe1xuICAgICAgICBjPXBvc2l0aW9uc1tpXS5pbmRleE9mKFwiYlwiKSsxO1xuICAgICAgICByPWkrMTtcbiAgICAgICAgcmVzdWx0PSBbcixjXTtcbiAgICAgIC8vY2hlY2sgaWYgY3VycmVudCBjb2x1bW4gbWF0Y2hlcyBhdCBsZWFzdCBvbmUgb2YgdGhlIGRlc2lyZWQgcGF0dGVybnNcbiAgICAgIH0gZWxzZSBpZihwYXR0ZXJucy5pbmNsdWRlcyhjb2x1bW4pKXtcbiAgICAgICAgcj1jb2x1bW4uaW5kZXhPZihcImJcIikrMTtcbiAgICAgICAgYz1pKzE7XG4gICAgICAgIHJlc3VsdD0gW3IsY107XG4gICAgICB9XG4gICAgfVxuICAgIC8vd2hlbiBib3RoIHJvdyBhbmQgY29sdW1ucyBhcmUgbm90IGZpdCBmb3Igc2xvdFxuICAgIC8vY2hlY2sgZm9yIGNvbXBsZXRlZCBwb3NpdGlvbnMgZGlhZ29uYWxseVxuICAgIHZhciBkaWFnMT1wb3NpdGlvbnNbMF1bMF0rcG9zaXRpb25zWzFdWzFdK3Bvc2l0aW9uc1syXVsyXTsgLy90b3AgbGVmdCB0byBib3R0b20gcmlnaHRcbiAgICB2YXIgZGlhZzI9cG9zaXRpb25zWzBdWzJdK3Bvc2l0aW9uc1sxXVsxXStwb3NpdGlvbnNbMl1bMF07IC8vdG9wIHJpZ2h0IHRvIGJvdHRvbSBsZWZ0XG4gICAgaWYocGF0dGVybnMuaW5jbHVkZXMoZGlhZzEpKXtcbiAgICAgIHZhciBpbmRleD1kaWFnMS5pbmRleE9mKFwiYlwiKTtcbiAgICAgIHI9aW5kZXgrMTtcbiAgICAgIGM9aW5kZXgrMTtcbiAgICAgIHJlc3VsdD0gW3IsY107XG4gICAgfSBlbHNlIGlmKHBhdHRlcm5zLmluY2x1ZGVzKGRpYWcyKSl7XG4gICAgICB2YXIgaW5kZXg9ZGlhZzIuaW5kZXhPZihcImJcIik7XG4gICAgICBjPTMtaW5kZXg7IC8vZm9yIHRvcCByaWdodCB0byBib3R0b20gbGVmdCwgY29sdW1uIGluZGV4IHJlZHVjZXMgYXMgcm93IGluZGV4IGluY3JlYXNlc1xuICAgICAgcj1pbmRleCsxO1xuICAgICAgcmVzdWx0PSBbcixjXTtcbiAgICB9XG4gICAgLy9pZiByZXN1bHQgaXMgYSB2YWxpZCBzbG90LCBzZWxlY3QgaXQgYnkgYWRkaW5nIGJvdCBjbGFzc1xuICAgIGlmKHJlc3VsdCl7XG4gICAgICB2YXIgbmV4dEJsb2NrPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjclwiK3Jlc3VsdFswXStcImNcIityZXN1bHRbMV0pO1xuICAgICAgbmV4dEJsb2NrLmNsYXNzTGlzdC5hZGQoYm90KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgICAvL2NhbGxpbmcgcHJvZ3JhbSBtYXkgbmVlZCBpdCBpbiBjYXNlIG5vIHNlbGVjdGlvbiB3YXMgZG9uZSAoaS5lIHJlc3VsdD1mYWxzZSlcbiAgfTtcblxuICAvKipcbiAgICAqIGdldCB3aW5uZXIgZGV0YWlsc1xuICAgICogc2hvdyB3aG8gaGFzIHdvblxuICAgICogaW5jbHVkZSBzdGFydCBhbmQgZW5kIGJsb2NrIHJvdy9jb2wgZGV0YWlsc1xuICAgICovXG4gIGZ1bmN0aW9uIGdldFdpbm5lcihwb3NpdGlvbnMpe1xuICAgIC8vbG9vayBmb3IgY29tcGxldGVkIHJvd3Mgb3IgY29sdW1ucyBpbiBwb3NpdGlvbnNcbiAgICAvL3JldHVybiB0aGUgd2lubmVyIGlmIGZvdW5kXG4gICAgdmFyIHJlc3VsdD1mYWxzZTtcbiAgICBmb3IodmFyIGk9MDtpPDM7aSsrKXtcbiAgICAgIHZhciBjb2x1bW49cG9zaXRpb25zWzBdW2ldK3Bvc2l0aW9uc1sxXVtpXStwb3NpdGlvbnNbMl1baV07XG4gICAgICAvL2xvb2sgYXQgY3VycmVudCByb3cgYW5kIGNvbHVtbiBmb3IgY29tcGxldGVkIHBhdHRlcm5zXG4gICAgICBpZihwb3NpdGlvbnNbaV09PT1cInh4eFwiKXtcbiAgICAgICAgcmVzdWx0PVtcInhcIixpKzEsMSxpKzEsM107XG4gICAgICB9IGVsc2UgaWYocG9zaXRpb25zW2ldPT09XCJvb29cIil7XG4gICAgICAgIHJlc3VsdD1bXCJvXCIsaSsxLDEsaSsxLDNdO1xuICAgICAgfSBlbHNlIGlmKGNvbHVtbj09PVwieHh4XCIpIHtcbiAgICAgICAgcmVzdWx0PVtcInhcIiwxLGkrMSwzLGkrMV07XG4gICAgICB9IGVsc2UgaWYoY29sdW1uPT09XCJvb29cIil7XG4gICAgICAgIHJlc3VsdD1bXCJvXCIsMSxpKzEsMyxpKzFdO1xuICAgICAgfVxuICAgICAgaWYocmVzdWx0KVxuICAgICAgICBicmVhazsgLy9icmVhayBpZiBhIHBhdHRlcm4gaXMgZm91bmQgdG8gYXZvaWQgZnVydGhlciBsb29waW5nXG4gICAgfVxuXG4gICAgLy9jaGVjayBmb3IgY29tcGxldGVkIHBvc2l0aW9ucyBkaWFnb25hbGx5XG4gICAgdmFyIGRpYWcxPXBvc2l0aW9uc1swXVswXStwb3NpdGlvbnNbMV1bMV0rcG9zaXRpb25zWzJdWzJdO1xuICAgIHZhciBkaWFnMj1wb3NpdGlvbnNbMF1bMl0rcG9zaXRpb25zWzFdWzFdK3Bvc2l0aW9uc1syXVswXTtcbiAgICBpZighcmVzdWx0KXsgLy9pZiB0aGVyZSB3YXNuJ3QgcGF0dGVybiBpbiByb3cvY29sdW1ucywgbG9vayBkaWFnb25hbGx5XG4gICAgICBpZihkaWFnMT09PVwieHh4XCIpe1xuICAgICAgICByZXN1bHQ9W1wieFwiLDEsMSwzLDNdO1xuICAgICAgfWVsc2UgaWYgKGRpYWcyPT09XCJ4eHhcIil7XG4gICAgICAgIHJlc3VsdD1bXCJ4XCIsMSwzLDMsMV07XG4gICAgICB9ZWxzZSBpZihkaWFnMT09PVwib29vXCIpe1xuICAgICAgICByZXN1bHQ9W1wib1wiLDEsMSwzLDNdO1xuICAgICAgfWVsc2UgaWYoZGlhZzI9PT1cIm9vb1wiKXtcbiAgICAgICAgcmVzdWx0PVtcIm9cIiwxLDMsMywxXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDsgLy9kZWZhdWx0IGZhbHNlIGlmIG5vIGNvbXBsZXRlZCBwYXR0ZXJuIGlzIGZvdW5kXG4gIH07XG5cbiAgLyoqXG4gICAgKiBnZXQgdGhlIGN1cnJlbnQgYm9hcmQgcG9zaXRpb25cbiAgICAqKioqKioqKioqKioqKioqKioqKioqKlxuICAgICogYiBzdGFuZHMgZm9yIGJsYW5rcyAqXG4gICAgKioqKioqKioqKioqKioqKioqKioqKipcbiAgICAqIGVhY2ggYmxvY2sgaGFzIHJYY1kgaWQgZm9ybWF0IGkuZSByMWMxIGZvciAxc3QgYmxvY2ssIHIzYzMgZm9yIDl0aFxuICAgICovXG4gIGZ1bmN0aW9uIGdldEdhbWVQb3NpdGlvbnMoKXtcbiAgICB2YXIgZ2FtZVBvc2l0aW9ucz1bXTtcbiAgICAvL2dvIHRocm91Z2ggZWFjaCByb3cgYW5kIGNvbGxlY3QgY3VycmVudCBzZWxlY3Rpb25zXG4gICAgZm9yKHZhciBpPTE7aTw0O2krKyl7XG4gICAgICB2YXIgcm93PVwiXCI7IC8vc3RhcnQgd2l0aCBjbGVhbiBzbGF0ZSBmb3IgZWFjaCByb3dcbiAgICAgIGZvcih2YXIgaj0xO2o8NDtqKyspe1xuICAgICAgICB2YXIgcG9zaXRpb249ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyXCIgKyBpICsgXCJjXCIgKyBqKTtcbiAgICAgICAgaWYocG9zaXRpb24uY2xhc3NMaXN0LmNvbnRhaW5zKFwieFwiKSlcbiAgICAgICAgICByb3crPVwieFwiO1xuICAgICAgICBlbHNlIGlmKHBvc2l0aW9uLmNsYXNzTGlzdC5jb250YWlucyhcIm9cIikpXG4gICAgICAgICAgcm93Kz1cIm9cIjtcbiAgICAgICAgZWxzZSAvL2JsYW5rXG4gICAgICAgICAgcm93Kz1cImJcIjtcbiAgICAgIH1cbiAgICAgIGdhbWVQb3NpdGlvbnMucHVzaChyb3cpO1xuICAgIH1cbiAgICByZXR1cm4gZ2FtZVBvc2l0aW9uczsgLy9mb3IgZXhhbXBsZSBbXCJ4eGJcIixcIm9vYlwiLFwib2J4XCJdXG4gIH07XG5cbiAgLyoqXG4gICAgKiBidXR0b24gY2xpY2sgaGFuZGxlciB0byBhZHZhbmNlIHRoZSBnYW1lXG4gICAgKiBlYWNoIHRpbWUgdXNlciBjbGlja3Mgb24gdGhlIGdhbWUgYmxvY2tcbiAgICAqL1xuICB2YXIgYnV0dG9ucz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmdhbWUgYnV0dG9uXCIpO1xuICBmb3IodmFyIGk9MDtpPGJ1dHRvbnMubGVuZ3RoO2krKyl7XG4gICAgYnV0dG9uc1tpXS5vbmNsaWNrPWJ1dHRvbkNsaWNrSGFuZGxlcjtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoaW1lKCl7XG4gICAgdmFyIGNoaW1lPW5ldyBBdWRpbyhcInB1YmxpYy9hdWRpby9jaGltZS5vZ2dcIik7XG4gICAgY2hpbWUucGxheSgpO1xuICB9XG59XG5cbi8qKlxuICAqIGhhbmRsZSBpbnB1dCBrZXlzXG4gICovXG5mdW5jdGlvbiBzZXR1cEtleUhhbmRsZXJzKCl7XG4gIGRvY3VtZW50Lm9ua2V5cHJlc3M9ZnVuY3Rpb24oZXZlbnQpe1xuICAgIHZhciBibG9ja051bT1wYXJzZUludChldmVudC5rZXkpOyAvL2p1c3QgaW4gY2FzZSB0aGUgZ2FtZSBpcyBvbiBhbmQgcGxheWVyIHByZXNzZWQga2V5cyAxIHRvIDlcbiAgICB2YXIgZ2FtZT1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2FtZScpO1xuICAgIHZhciBnYW1lT249Z2FtZS5jbGFzc0xpc3QuY29udGFpbnMoXCJvZmZcIikgPyBmYWxzZSA6IHRydWU7XG4gICAgaWYoZXZlbnQua2V5LnRvVXBwZXJDYXNlKCk9PSdYJyAmJiAhZ2FtZU9uKVxuICAgICAgLy9zaW11bGF0ZSBvcHRpb24geCBzZWxlY3Rpb24gKGdhbWUgc2hvdWxkIGJlIG9mZilcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXIueCcpLmNsaWNrKCk7XG4gICAgZWxzZSBpZihldmVudC5rZXkudG9VcHBlckNhc2UoKT09J08nICYmICFnYW1lT24pXG4gICAgLy9zaW11bGF0ZSBvcHRpb24gTyBzZWxlY3Rpb24gKGdhbWUgc2hvdWxkIGJlIG9mZilcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXIubycpLmNsaWNrKCk7XG4gICAgZWxzZSBpZihnYW1lT24gJiYgYmxvY2tOdW0+MCAmJiBibG9ja051bTwxMCl7XG4gICAgICAvL3NpbXVsYXRlIG9uZSBvZiB0aGUgYmxvY2sgc2VsZWN0aW9uIChnYW1lIHNob3VsZCBiZSBvbilcbiAgICAgIHZhciBibG9ja0lEPVwiI3JcIiArIE1hdGguY2VpbChibG9ja051bS8zKTsgLy9kaXZpZGUgdG8gZ2V0IHJvdyBudW1iZXJcbiAgICAgIGJsb2NrSUQrPVwiY1wiICsgKChibG9ja051bSAlIDM9PTApID8gMzooYmxvY2tOdW0lMykpOyAvL21vZHVsbyB0byBnZXQgY29sdW1uIG51bWJlclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihibG9ja0lEKS5jbGljaygpOyAvL3NpbXVsYXRlIGNsaWNrIChhcyBjbGljayBoYXMgdGhlIGNvcmUgZnVuY3Rpb25hbHR5IGNvdXBsZWQpXG4gICAgfVxuICB9O1xufVxuIl19
