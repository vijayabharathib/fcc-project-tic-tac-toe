function setupPlayerOption(){function o(){var o=Math.floor(3*Math.random())+1,t=Math.floor(3*Math.random())+1,e=document.querySelector("#r"+o+"c"+t);e.classList.add("x")}var t=function(){bot=this.classList.contains("x")?"o":"x",player="x"===bot?"o":"x";var t=document.querySelector(".game");t.classList.remove("off"),t.classList.add("on");var e=document.querySelector(".status");e.innerText="Game on","x"===bot&&o()},e=document.querySelectorAll(".player");e[0].onclick=t,e[1].onclick=t}function setupPlayerInput(){function o(){result="Game on",positions=l(),winner=i(positions),winner?(n(winner),result=winner[0]==bot?"Bot ("+bot+") wins.":"You ("+player+") win!"):t()&&(result="It's a tie!");var o=document.querySelector(".status");return o.innerText=result,result}function t(){return positions=l(),winner=i(positions),!winner&&!positions.toString().includes("b")}function e(){positions=l();var o=[bot+bot+"b",bot+"b"+bot,"b"+bot+bot],t=s(positions,o);if(console.log("fill "+t+" to win."),t);else{var e=[player+player+"b",player+"b"+player,"b"+player+player];if(t=s(positions,e),console.log("fill "+t+" to defend"),t);else{var r=[bot+"bb","bb"+bot,"b"+bot+"b"];if(t=s(positions,r),console.log("fill "+t+" to position strategically"),t);else{var n=[player+"bb","bb"+player,"b"+player+"b"];if(t=s(positions,n),console.log("fill "+t+" to position next to player"),t);else{t=s(positions,n),console.log("fill "+t+" to cover last position")}}}}}function n(o){if(o[1]==o[3]||o[2]==o[4])for(var t=o[1];t<=o[3];t++)for(var e=o[2];e<=o[4];e++){var r=document.querySelector("#r"+t+"c"+e);r.classList.add("win")}else if(1==o[1]&&3==o[2])for(var n=1;n<4;n++){var r=document.querySelector("#r"+n+"c"+(4-n));r.classList.add("win")}else if(1==o[1]&&1==o[2])for(var n=1;n<4;n++){var r=document.querySelector("#r"+n+"c"+n);r.classList.add("win")}}function s(o,t){console.log("patterns: "+t);for(var e=!1,n=0;n<3;n++){var s=o[0][n]+o[1][n]+o[2][n];t.includes(o[n])?(c=o[n].indexOf("b")+1,r=n+1,e=[r,c]):t.includes(s)&&(r=s.indexOf("b")+1,c=n+1,e=[r,c])}var i=o[0][0]+o[1][1]+o[2][2],l=o[0][2]+o[1][1]+o[2][0];if(t.includes(i)){var a=i.indexOf("b");r=a+1,c=a+1,e=[r,c]}else if(t.includes(l)){var a=l.indexOf("b");c=3-a,r=a+1,e=[r,c]}if(console.log("after diagonal check result:"+e),e){console.log("findbestslot:trying to fill slot");var u=document.querySelector("#r"+e[0]+"c"+e[1]);u.classList.add(bot)}return e}function i(o){for(var t=!1,e=0;e<3;e++){var r=o[0][e]+o[1][e]+o[2][e];if("xxx"===o[e]?t=["x",e+1,1,e+1,3]:"ooo"===o[e]?t=["o",e+1,1,e+1,3]:"xxx"===r?t=["x",1,e+1,3,e+1]:"ooo"===r&&(t=["o",1,e+1,3,e+1]),t)break}var n=o[0][0]+o[1][1]+o[2][2],s=o[0][2]+o[1][1]+o[2][0];return t||("xxx"===n?t=["x",1,1,3,3]:"xxx"===s?t=["x",1,3,3,1]:"ooo"===n?t=["o",1,1,3,3]:"ooo"===s&&(t=["0",1,3,3,1])),t}function l(){for(var o=[],t=1;t<4;t++){for(var e="",r=1;r<4;r++){var n=document.querySelector("#r"+t+"c"+r);e+=n.classList.contains("x")?"x":n.classList.contains("o")?"o":"b"}o.push(e)}return o}for(var a=document.querySelectorAll(".game button"),u=function(){var t=l(),r=i(t);r||this.classList.contains("x")||this.classList.contains("o")||this.classList.add(player);var n=o();console.log("game status after user input: "+n),"Game on"==n&&(e(),o())},f=0;f<a.length;f++)a[f].onclick=u}var player="b",bot="b";document.addEventListener("DOMContentLoaded",function(o){setupPlayerOption(),setupPlayerInput()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsic2V0dXBQbGF5ZXJPcHRpb24iLCJmaXJzdE1vdmUiLCJyIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiYyIsInJhbmQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjbGFzc0xpc3QiLCJhZGQiLCJwbGF5ZXJDaG9pY2UiLCJib3QiLCJ0aGlzIiwiY29udGFpbnMiLCJwbGF5ZXIiLCJnYW1lIiwicmVtb3ZlIiwic3RhdHVzIiwiaW5uZXJUZXh0IiwicGxheWVyT3B0aW9ucyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJvbmNsaWNrIiwic2V0dXBQbGF5ZXJJbnB1dCIsImV2YWx1YXRlR2FtZVN0YXR1cyIsInJlc3VsdCIsInBvc2l0aW9ucyIsImdldEdhbWVQb3NpdGlvbnMiLCJ3aW5uZXIiLCJnZXRXaW5uZXIiLCJmb3JtYXRXaW5uZXIiLCJnYW1lVGllIiwidG9TdHJpbmciLCJpbmNsdWRlcyIsImJvdFJlc3BvbnNlIiwid2luUGF0dGVybnMiLCJuZXh0IiwiZmlsbE5leHRCZXN0U2xvdCIsImNvbnNvbGUiLCJsb2ciLCJkZWZlbmNlUGF0dGVybnMiLCJzdHJhdGVnaWNXaW5QYXR0ZXJucyIsInN0cmF0ZWdpY0RlZmVuY2VQYXR0ZXJucyIsImJsb2NrIiwiaSIsInBhdHRlcm5zIiwiY29sdW1uIiwiaW5kZXhPZiIsImRpYWcxIiwiZGlhZzIiLCJpbmRleCIsIm5leHRCbG9jayIsImdhbWVQb3NpdGlvbnMiLCJyb3ciLCJqIiwicG9zaXRpb24iLCJwdXNoIiwiYnV0dG9ucyIsImJ1dHRvbkNsaWNrSGFuZGxlciIsImdhbWVTdGF0dXMiLCJsZW5ndGgiLCJhZGRFdmVudExpc3RlbmVyIiwiZSJdLCJtYXBwaW5ncyI6IkFBYUEsUUFBU0EscUJBYVAsUUFBU0MsS0FDUCxHQUFJQyxHQUFFQyxLQUFLQyxNQUFvQixFQUFkRCxLQUFLRSxVQUFZLEVBQzlCQyxFQUFFSCxLQUFLQyxNQUFvQixFQUFkRCxLQUFLRSxVQUFZLEVB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QUVuREQsSUFEQ0UsRUFBUzlDLFVBQVVLLFNBQVMsS0FDeEIsSUFDQ3lDLEVBQVM5QyxVQUFVSyxTQUFTLEtBQzdCLElBRUEsSUFFVHNDLEVBQWNJLEtBQUtILEdBRXJCLE1BQU9ELEdBR1QsSUFBSSxHQXJPQUssR0FBUWxELFNBQVNjLGlCQUFpQixnQkFDbENxQyxFQUFtQixXQUNyQixHQUFJaEMsR0FBVUMsSUFDVkMsRUFBT0MsRUFBVUgsRUFFakJFLElBQVdmLEtBQUtKLFVBQVVLLFNBQVMsTUFBU0QsS0FBS0osVUFBVUssU0FBUyxNQUN0RUQsS0FBS0osVUFBVUMsSUFBSUssT0FTckIsSUFBSTRDLEdBQVduQyxHQUNmYyxTQUFRQyxJQUFJLGlDQUFtQ29CLEdBQ2hDLFdBQVpBLElBQ0R6QixJQUNBVixNQWtOSW9CLEVBQUUsRUFBRUEsRUFBRWEsRUFBUUcsT0FBT2hCLElBQzNCYSxFQUFRYixHQUFHdEIsUUFBUW9DLEVBM1FyQixHQUFJM0MsUUFBTyxJQUNQSCxJQUFJLEdBQ1ZMLFVBQVNzRCxpQkFBaUIsbUJBQW1CLFNBQVNDLEdBSXBEL0Qsb0JBQ0F3QiIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gICogd2FpdCB1bnRpbCB0aGUgZG9jIGlzIHJlYWR5IHRvIG9iZXkgb3JkZXJzXG4gICovXG4gIHZhciBwbGF5ZXI9XCJiXCI7XG4gIHZhciBib3Q9XCJiXCI7XG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLGZ1bmN0aW9uKGUpe1xuICAvKipcbiAgICAqIG9uY2UgY29udGVudCBpcyBsb2FkZWRcbiAgICAqL1xuICBzZXR1cFBsYXllck9wdGlvbigpO1xuICBzZXR1cFBsYXllcklucHV0KCk7XG59KTtcblxuZnVuY3Rpb24gc2V0dXBQbGF5ZXJPcHRpb24oKXtcbiAgdmFyIHBsYXllckNob2ljZT1mdW5jdGlvbigpe1xuICAgIGJvdD0odGhpcy5jbGFzc0xpc3QuY29udGFpbnMoXCJ4XCIpKSA/IFwib1wiIDogXCJ4XCI7XG4gICAgcGxheWVyPShib3Q9PT1cInhcIikgPyBcIm9cIiA6IFwieFwiO1xuICAgIHZhciBnYW1lPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5nYW1lJyk7XG4gICAgZ2FtZS5jbGFzc0xpc3QucmVtb3ZlKCdvZmYnKTtcbiAgICBnYW1lLmNsYXNzTGlzdC5hZGQoJ29uJyk7XG4gICAgdmFyIHN0YXR1cz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3RhdHVzJyk7XG4gICAgc3RhdHVzLmlubmVyVGV4dD1cIkdhbWUgb25cIjtcbiAgICBpZihib3Q9PT1cInhcIilcbiAgICAgIGZpcnN0TW92ZSgpO1xuICB9O1xuXG4gIGZ1bmN0aW9uIGZpcnN0TW92ZSgpe1xuICAgIHZhciByPU1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSozKSsxO1xuICAgIHZhciBjPU1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSozKSsxO1xuICAgIHZhciByYW5kPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjclwiKyByICsgXCJjXCIgK2MpO1xuICAgIHJhbmQuY2xhc3NMaXN0LmFkZChcInhcIik7XG4gIH07XG5cbiAgdmFyIHBsYXllck9wdGlvbnM9ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBsYXllcicpO1xuICBwbGF5ZXJPcHRpb25zWzBdLm9uY2xpY2s9cGxheWVyQ2hvaWNlO1xuICBwbGF5ZXJPcHRpb25zWzFdLm9uY2xpY2s9cGxheWVyQ2hvaWNlO1xuXG59XG5cbmZ1bmN0aW9uIHNldHVwUGxheWVySW5wdXQoKXtcbiAgdmFyIGJ1dHRvbnM9ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5nYW1lIGJ1dHRvblwiKTtcbiAgdmFyIGJ1dHRvbkNsaWNrSGFuZGxlcj1mdW5jdGlvbigpe1xuICAgIHZhciBwb3NpdGlvbnM9Z2V0R2FtZVBvc2l0aW9ucygpO1xuICAgIHZhciB3aW5uZXI9Z2V0V2lubmVyKHBvc2l0aW9ucyk7XG4gICAgLy8gZG8gbm90aGluZyBpZiB0aGUgYmxvY2sgYWxyZWFkeSBoYXMgeCBvciBvIChhbmQgdGhlIGdhbWUgaXMgc3RpbGwgb24pXG4gICAgaWYoIXdpbm5lciAmJiAhdGhpcy5jbGFzc0xpc3QuY29udGFpbnMoXCJ4XCIpICYmICF0aGlzLmNsYXNzTGlzdC5jb250YWlucyhcIm9cIikpe1xuICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKHBsYXllcik7XG4gICAgfVxuICAgIC8qcG9zaXRpb25zPWdldEdhbWVQb3NpdGlvbnMoKTsgLy9nZXQgcG9zaXRpb25zIGFnYWluLCBiYXNlZCBvbiBsYXN0IHVzZXIgaW5wdXRcbiAgICB3aW5uZXI9Z2V0V2lubmVyKHBvc2l0aW9ucyk7XG4gICAgY29uc29sZS5sb2cod2lubmVyKTtcbiAgICBpZih3aW5uZXIpe1xuICAgICAgZm9ybWF0V2lubmVyKHdpbm5lcik7XG4gICAgICByZXR1cm47IC8vZ2FtZW92ZXJcbiAgICB9Ki9cbiAgICB2YXIgZ2FtZVN0YXR1cz1ldmFsdWF0ZUdhbWVTdGF0dXMoKTsgLy9mb3IgdXNlciBpbnB1dFxuICAgIGNvbnNvbGUubG9nKFwiZ2FtZSBzdGF0dXMgYWZ0ZXIgdXNlciBpbnB1dDogXCIgKyBnYW1lU3RhdHVzKTtcbiAgICBpZihnYW1lU3RhdHVzPT1cIkdhbWUgb25cIil7XG4gICAgICBib3RSZXNwb25zZSgpO1xuICAgICAgZXZhbHVhdGVHYW1lU3RhdHVzKCk7IC8vZm9yIGJvdCByZXNwb25zZVxuICAgIH1cbiAgfTtcblxuICBmdW5jdGlvbiBldmFsdWF0ZUdhbWVTdGF0dXMoKXtcbiAgICByZXN1bHQ9XCJHYW1lIG9uXCI7XG4gICAgcG9zaXRpb25zPWdldEdhbWVQb3NpdGlvbnMoKTsgLy9nZXQgcG9zaXRpb25zIGFnYWluLCBiYXNlZCBvbiBsYXN0IHVzZXIgaW5wdXRcbiAgICB3aW5uZXI9Z2V0V2lubmVyKHBvc2l0aW9ucyk7XG4gICAgaWYod2lubmVyKXtcbiAgICAgIGZvcm1hdFdpbm5lcih3aW5uZXIpO1xuICAgICAgcmVzdWx0PSh3aW5uZXJbMF09PWJvdCk/IFwiQm90IChcIisgYm90ICsgXCIpIHdpbnMuXCIgOiBcIllvdSAoXCIgKyBwbGF5ZXIgKyBcIikgd2luIVwiO1xuICAgIH1lbHNlIGlmIChnYW1lVGllKCkpe1xuICAgICAgcmVzdWx0PVwiSXQncyBhIHRpZSFcIjtcbiAgICB9XG4gICAgdmFyIHN0YXR1cz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3RhdHVzJyk7XG4gICAgc3RhdHVzLmlubmVyVGV4dD1yZXN1bHQ7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuICBmdW5jdGlvbiBnYW1lVGllKCl7XG4gICAgcG9zaXRpb25zPWdldEdhbWVQb3NpdGlvbnMoKTtcbiAgICB3aW5uZXI9Z2V0V2lubmVyKHBvc2l0aW9ucyk7XG4gICAgcmV0dXJuICghd2lubmVyICYmICFwb3NpdGlvbnMudG9TdHJpbmcoKS5pbmNsdWRlcyhcImJcIikpOyAvL25vIG9uZSBoYXMgd29uIGFuZCBubyBibGFua3M7XG4gIH1cbiAgZnVuY3Rpb24gYm90UmVzcG9uc2UoKXtcbiAgICBwb3NpdGlvbnM9Z2V0R2FtZVBvc2l0aW9ucygpOyAvL2dldCBjdXJyZW50IGdhbWUgcG9zaXRpb25zXG4gICAgdmFyIHdpblBhdHRlcm5zPVtib3QrYm90K1wiYlwiLGJvdCtcImJcIitib3QsXCJiXCIrYm90K2JvdF07XG4gICAgLy90cnkgdG8gd2luIGZpcnN0XG4gICAgdmFyIG5leHQ9ZmlsbE5leHRCZXN0U2xvdChwb3NpdGlvbnMsd2luUGF0dGVybnMpO1xuICAgIGNvbnNvbGUubG9nKFwiZmlsbCBcIiArIG5leHQgKyBcIiB0byB3aW4uXCIpO1xuICAgIGlmKG5leHQpe1xuICAgICAgLyp2YXIgbmV4dEJsb2NrPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjclwiK25leHRbMF0rXCJjXCIrbmV4dFsxXSk7XG4gICAgICBuZXh0QmxvY2suY2xhc3NMaXN0LmFkZChib3QpOyovXG4gICAgICAvKnBvc2l0aW9ucz1nZXRHYW1lUG9zaXRpb25zKCk7XG4gICAgICB3aW5uZXI9Z2V0V2lubmVyKHBvc2l0aW9ucyk7XG4gICAgICBjb25zb2xlLmxvZyhcIndpbm5lcjpcIit3aW5uZXIpO1xuICAgICAgaWYod2lubmVyKXtcbiAgICAgICAgZm9ybWF0V2lubmVyKHdpbm5lcik7XG4gICAgICAgIHJldHVybjsgLy9nYW1lb3ZlclxuICAgICAgfSovXG4gICAgfWVsc2V7XG4gICAgICAvL3NlY29uZCBpcyB0byB0cnkgYW5kIGRlZmVuZFxuICAgICAgdmFyIGRlZmVuY2VQYXR0ZXJucz1bcGxheWVyK3BsYXllcitcImJcIixwbGF5ZXIrXCJiXCIrcGxheWVyLFwiYlwiK3BsYXllcitwbGF5ZXJdO1xuICAgICAgbmV4dD1maWxsTmV4dEJlc3RTbG90KHBvc2l0aW9ucyxkZWZlbmNlUGF0dGVybnMpO1xuICAgICAgY29uc29sZS5sb2coXCJmaWxsIFwiICsgbmV4dCArIFwiIHRvIGRlZmVuZFwiKTtcbiAgICAgIGlmKG5leHQpe1xuICAgICAgICAvKnZhciBuZXh0QmxvY2s9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyXCIrbmV4dFswXStcImNcIituZXh0WzFdKTtcbiAgICAgICAgbmV4dEJsb2NrLmNsYXNzTGlzdC5hZGQoYm90KTsqL1xuICAgICAgfWVsc2V7IC8vdGhpcmQsIHRyeSB0byBwb3NpdGlvbiBib3Qgc2lkZSBieSBzaWRlLCBpbiByZWFkaW5lc3MgZm9yIG5leHQgd2luXG4gICAgICAgIHZhciBzdHJhdGVnaWNXaW5QYXR0ZXJucz1bYm90K1wiYmJcIixcImJiXCIrYm90LFwiYlwiK2JvdCtcImJcIl07XG4gICAgICAgIG5leHQ9ZmlsbE5leHRCZXN0U2xvdChwb3NpdGlvbnMsc3RyYXRlZ2ljV2luUGF0dGVybnMpO1xuICAgICAgICBjb25zb2xlLmxvZyhcImZpbGwgXCIgKyBuZXh0ICsgXCIgdG8gcG9zaXRpb24gc3RyYXRlZ2ljYWxseVwiKTtcbiAgICAgICAgaWYobmV4dCl7XG4gICAgICAgICAgLyp2YXIgbmV4dEJsb2NrPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjclwiK25leHRbMF0rXCJjXCIrbmV4dFsxXSk7XG4gICAgICAgICAgbmV4dEJsb2NrLmNsYXNzTGlzdC5hZGQoYm90KTsqL1xuICAgICAgICB9ZWxzZXsgLy9tdXN0IGJlIGVhcmx5IHN0YWdlcywgdHJ5IHRvIHBvc2l0aW9uIHJpZ2h0IG5leHQgdG8gdGhlIHBsYXllclxuICAgICAgICAgIHZhciBzdHJhdGVnaWNEZWZlbmNlUGF0dGVybnM9W3BsYXllcitcImJiXCIsXCJiYlwiK3BsYXllcixcImJcIitwbGF5ZXIrXCJiXCJdO1xuICAgICAgICAgIG5leHQ9ZmlsbE5leHRCZXN0U2xvdChwb3NpdGlvbnMsc3RyYXRlZ2ljRGVmZW5jZVBhdHRlcm5zKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcImZpbGwgXCIgKyBuZXh0ICsgXCIgdG8gcG9zaXRpb24gbmV4dCB0byBwbGF5ZXJcIik7XG4gICAgICAgICAgaWYobmV4dCl7XG4gICAgICAgICAgICAvKnZhciBuZXh0QmxvY2s9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyXCIrbmV4dFswXStcImNcIituZXh0WzFdKTtcbiAgICAgICAgICAgIG5leHRCbG9jay5jbGFzc0xpc3QuYWRkKGJvdCk7Ki9cbiAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHZhciBvbmVMYXN0U2xvdFBhdHRlcm5zPVtcbiAgICAgICAgICAgICAgcGxheWVyK1wiYlwiK2JvdCxcbiAgICAgICAgICAgICAgYm90K1wiYlwiK3BsYXllcixcbiAgICAgICAgICAgICAgXCJiXCIrcGxheWVyK2JvdCxcbiAgICAgICAgICAgICAgXCJiXCIrYm90K3BsYXllclxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIG5leHQ9ZmlsbE5leHRCZXN0U2xvdChwb3NpdGlvbnMsc3RyYXRlZ2ljRGVmZW5jZVBhdHRlcm5zKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZmlsbCBcIiArIG5leHQgKyBcIiB0byBjb3ZlciBsYXN0IHBvc2l0aW9uXCIpO1xuICAgICAgICAgICAgaWYobmV4dCl7XG4gICAgICAgICAgICAgIC8qdmFyIG5leHRCbG9jaz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JcIituZXh0WzBdK1wiY1wiK25leHRbMV0pO1xuICAgICAgICAgICAgICBuZXh0QmxvY2suY2xhc3NMaXN0LmFkZChib3QpOyovXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyNUT0RPOiBzdGlsbCByZW1haW5pbmcgYmxvY2sgaXMgbm90IGZpbGxlZFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgICogZm9ybWF0IHdpbm5lciBvcmRlclxuICAgICovXG4gIGZ1bmN0aW9uIGZvcm1hdFdpbm5lcih3aW5uZXIpe1xuICAgIGlmKHdpbm5lclsxXT09d2lubmVyWzNdIHx8IHdpbm5lclsyXT09d2lubmVyWzRdKXsgLy9yb3cgb3IgY29sdW1uXG4gICAgICBmb3IodmFyIHI9d2lubmVyWzFdO3I8PXdpbm5lclszXTtyKyspe1xuICAgICAgICBmb3IodmFyIGM9d2lubmVyWzJdO2M8PXdpbm5lcls0XTtjKyspe1xuICAgICAgICAgIHZhciBibG9jaz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JcIiArIHIgKyBcImNcIiArIGMpO1xuICAgICAgICAgIGJsb2NrLmNsYXNzTGlzdC5hZGQoXCJ3aW5cIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9ZWxzZSBpZih3aW5uZXJbMV09PTEgJiYgd2lubmVyWzJdPT0zKXsgLy9ib3R0b20gbGVmdCB0byB0b3AgcmlnaHRcbiAgICAgIGZvcih2YXIgaT0xO2k8NDtpKyspe1xuICAgICAgICB2YXIgYmxvY2s9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyXCIgKyBpICsgXCJjXCIgKyAoNC1pKSk7XG4gICAgICAgIGJsb2NrLmNsYXNzTGlzdC5hZGQoXCJ3aW5cIik7XG4gICAgICB9XG4gICAgfWVsc2UgaWYod2lubmVyWzFdPT0xICYmIHdpbm5lclsyXT09MSl7IC8vdG9wIGxlZnQgdG8gYm90dG9tIHJpZ2h0XG4gICAgICBmb3IodmFyIGk9MTtpPDQ7aSsrKXtcbiAgICAgICAgdmFyIGJsb2NrPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjclwiICsgaSArIFwiY1wiICsgaSk7XG4gICAgICAgIGJsb2NrLmNsYXNzTGlzdC5hZGQoXCJ3aW5cIik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAgKiBsb29rIGZvciBwcm92aWRlZCBwYXR0ZXJzIGluIHRoZSBjdXJyZW50IHBvc2l0aW9uc1xuICAgICogYW5kIHJldHVybiBiZXN0IHNsb3QgdGhhdCBtYXRjaGVzIHRoZSBwYXR0ZXJuXG4gICAgKiByZXR1cm4gZmFsc2UgaWYgbm8gc3VjaCBtYXRjaFxuICAgICovXG4gIGZ1bmN0aW9uIGZpbGxOZXh0QmVzdFNsb3QocG9zaXRpb25zLHBhdHRlcm5zKXtcbiAgICAvL2xvb2sgZm9yIGNvbXBsZXRlZCByb3dzIG9yIGNvbHVtbnMgaW4gcG9zaXRpb25zXG4gICAgLy9yZXR1cm4gdGhlIHdpbm5lciBpZiBmb3VuZFxuICAgIGNvbnNvbGUubG9nKFwicGF0dGVybnM6IFwiICsgcGF0dGVybnMpO1xuICAgIHZhciByZXN1bHQ9ZmFsc2U7XG4gICAgZm9yKHZhciBpPTA7aTwzO2krKyl7XG4gICAgICB2YXIgY29sdW1uPXBvc2l0aW9uc1swXVtpXStwb3NpdGlvbnNbMV1baV0rcG9zaXRpb25zWzJdW2ldO1xuXG4gICAgICBpZihwYXR0ZXJucy5pbmNsdWRlcyhwb3NpdGlvbnNbaV0pKXtcbiAgICAgICAgYz1wb3NpdGlvbnNbaV0uaW5kZXhPZihcImJcIikrMTtcbiAgICAgICAgcj1pKzE7XG4gICAgICAgIHJlc3VsdD0gW3IsY107XG4gICAgICB9IGVsc2UgaWYocGF0dGVybnMuaW5jbHVkZXMoY29sdW1uKSl7XG4gICAgICAgIHI9Y29sdW1uLmluZGV4T2YoXCJiXCIpKzE7XG4gICAgICAgIGM9aSsxO1xuICAgICAgICByZXN1bHQ9IFtyLGNdO1xuICAgICAgfVxuICAgIH1cbiAgICAvKmlmKHJlc3VsdCl7XG4gICAgICBjb25zb2xlLmxvZyhcInJvdy9jb2wgcmVzdWx0OlwiICsgcmVzdWx0KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSovXG5cbiAgICAvL2NoZWNrIGZvciBjb21wbGV0ZWQgcG9zaXRpb25zIGRpYWdvbmFsbHlcbiAgICB2YXIgZGlhZzE9cG9zaXRpb25zWzBdWzBdK3Bvc2l0aW9uc1sxXVsxXStwb3NpdGlvbnNbMl1bMl07XG4gICAgdmFyIGRpYWcyPXBvc2l0aW9uc1swXVsyXStwb3NpdGlvbnNbMV1bMV0rcG9zaXRpb25zWzJdWzBdO1xuICAgIGlmKHBhdHRlcm5zLmluY2x1ZGVzKGRpYWcxKSl7XG4gICAgICB2YXIgaW5kZXg9ZGlhZzEuaW5kZXhPZihcImJcIik7XG4gICAgICByPWluZGV4KzE7XG4gICAgICBjPWluZGV4KzE7XG4gICAgICByZXN1bHQ9IFtyLGNdO1xuICAgIH0gZWxzZSBpZihwYXR0ZXJucy5pbmNsdWRlcyhkaWFnMikpe1xuICAgICAgdmFyIGluZGV4PWRpYWcyLmluZGV4T2YoXCJiXCIpO1xuICAgICAgYz0zLWluZGV4O1xuICAgICAgcj1pbmRleCsxO1xuICAgICAgcmVzdWx0PSBbcixjXTtcbiAgICB9XG4gICAgY29uc29sZS5sb2coXCJhZnRlciBkaWFnb25hbCBjaGVjayByZXN1bHQ6XCIgKyByZXN1bHQpO1xuICAgIGlmKHJlc3VsdCl7XG4gICAgICBjb25zb2xlLmxvZyhcImZpbmRiZXN0c2xvdDp0cnlpbmcgdG8gZmlsbCBzbG90XCIpO1xuICAgICAgdmFyIG5leHRCbG9jaz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JcIityZXN1bHRbMF0rXCJjXCIrcmVzdWx0WzFdKTtcbiAgICAgIG5leHRCbG9jay5jbGFzc0xpc3QuYWRkKGJvdCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgZnVuY3Rpb24gZ2V0V2lubmVyKHBvc2l0aW9ucyl7XG4gICAgLy9sb29rIGZvciBjb21wbGV0ZWQgcm93cyBvciBjb2x1bW5zIGluIHBvc2l0aW9uc1xuICAgIC8vcmV0dXJuIHRoZSB3aW5uZXIgaWYgZm91bmRcbiAgICB2YXIgcmVzdWx0PWZhbHNlO1xuICAgIGZvcih2YXIgaT0wO2k8MztpKyspe1xuICAgICAgdmFyIGNvbHVtbj1wb3NpdGlvbnNbMF1baV0rcG9zaXRpb25zWzFdW2ldK3Bvc2l0aW9uc1syXVtpXTtcbiAgICAgIGlmKHBvc2l0aW9uc1tpXT09PVwieHh4XCIpe1xuICAgICAgICByZXN1bHQ9W1wieFwiLGkrMSwxLGkrMSwzXTtcbiAgICAgIH0gZWxzZSBpZihwb3NpdGlvbnNbaV09PT1cIm9vb1wiKXtcbiAgICAgICAgcmVzdWx0PVtcIm9cIixpKzEsMSxpKzEsM107XG4gICAgICB9IGVsc2UgaWYoY29sdW1uPT09XCJ4eHhcIikge1xuICAgICAgICByZXN1bHQ9W1wieFwiLDEsaSsxLDMsaSsxXTtcbiAgICAgIH0gZWxzZSBpZihjb2x1bW49PT1cIm9vb1wiKXtcbiAgICAgICAgcmVzdWx0PVtcIm9cIiwxLGkrMSwzLGkrMV07XG4gICAgICB9XG4gICAgICBpZihyZXN1bHQpXG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8vY2hlY2sgZm9yIGNvbXBsZXRlZCBwb3NpdGlvbnMgZGlhZ29uYWxseVxuICAgIHZhciBkaWFnMT1wb3NpdGlvbnNbMF1bMF0rcG9zaXRpb25zWzFdWzFdK3Bvc2l0aW9uc1syXVsyXTtcbiAgICB2YXIgZGlhZzI9cG9zaXRpb25zWzBdWzJdK3Bvc2l0aW9uc1sxXVsxXStwb3NpdGlvbnNbMl1bMF07XG4gICAgaWYoIXJlc3VsdCl7XG4gICAgICBpZihkaWFnMT09PVwieHh4XCIpe1xuICAgICAgICByZXN1bHQ9W1wieFwiLDEsMSwzLDNdO1xuICAgICAgfWVsc2UgaWYgKGRpYWcyPT09XCJ4eHhcIil7XG4gICAgICAgIHJlc3VsdD1bXCJ4XCIsMSwzLDMsMV07XG4gICAgICB9ZWxzZSBpZihkaWFnMT09PVwib29vXCIpe1xuICAgICAgICByZXN1bHQ9W1wib1wiLDEsMSwzLDNdO1xuICAgICAgfWVsc2UgaWYoZGlhZzI9PT1cIm9vb1wiKXtcbiAgICAgICAgcmVzdWx0PVtcIjBcIiwxLDMsMywxXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBmdW5jdGlvbiBnZXRHYW1lUG9zaXRpb25zKCl7XG4gICAgdmFyIGdhbWVQb3NpdGlvbnM9W107XG4gICAgZm9yKHZhciBpPTE7aTw0O2krKyl7XG4gICAgICB2YXIgcm93PVwiXCI7XG4gICAgICBmb3IodmFyIGo9MTtqPDQ7aisrKXtcbiAgICAgICAgdmFyIHBvc2l0aW9uPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjclwiICsgaSArIFwiY1wiICsgaik7XG4gICAgICAgIGlmKHBvc2l0aW9uLmNsYXNzTGlzdC5jb250YWlucyhcInhcIikpXG4gICAgICAgICAgcm93Kz1cInhcIjtcbiAgICAgICAgZWxzZSBpZihwb3NpdGlvbi5jbGFzc0xpc3QuY29udGFpbnMoXCJvXCIpKVxuICAgICAgICAgIHJvdys9XCJvXCI7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICByb3crPVwiYlwiO1xuICAgICAgfVxuICAgICAgZ2FtZVBvc2l0aW9ucy5wdXNoKHJvdyk7XG4gICAgfVxuICAgIHJldHVybiBnYW1lUG9zaXRpb25zO1xuICB9O1xuXG4gIGZvcih2YXIgaT0wO2k8YnV0dG9ucy5sZW5ndGg7aSsrKXtcbiAgICBidXR0b25zW2ldLm9uY2xpY2s9YnV0dG9uQ2xpY2tIYW5kbGVyO1xuICB9XG5cbn1cbiJdfQ==
